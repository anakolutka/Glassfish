<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>AMX</title>
  <style type="text/css">
<!--
.style1 {font-family: "Courier New", Courier, monospace}
-->
  </style>
</head>
<body style="background-color: white;">
<p>Load balancer package summary. <br>
</p>
<p><b><font size="+1">Contents</font></b><br>
</p>
<p><a href="#Overview">Overview</a><br>
<a href="#API">API</a><br>
<a href="#Examples">Examples<br>
</a><span style="font-weight: bold;"><br>
<br>
</span><b><font size="+1"><a name="Overview"></a>Overview<br>
</font></b></p>
<p>The Load balancer administration is a glassfish component used to
manage the HTTP Load balancer Plugin of the Webserver. HTTP LB plug-in
stores its configuration in loadbalancer.xml. Instead
of asking users to manually edit this loadbalancer.xml, we can generate
loadbalancer.xml and push it to the HTTP LB plug-in automatically. This
reduces chances of manual errors. In Glassfish,
a load balancer configuration is a named configuration in
the <tt>domain.xml</tt> file. Load balancer configuration can contain
clusters or stand alone instances. It also has optional configuration
for configuring the policy, weights to instances, LB device host and
port details to push the loadbalancer.xml when certain changes happen
(adding/deleting instance, deploy/undeploy,enable/disable an app etc.,)
and health-check information. The AMX API for Load balancer provides an
interface to configure this component programmatically.<br>
<br style="font-weight: bold;">
<span style="font-weight: bold;">API</span><font size="+1"><span
 style="font-weight: bold;"></span><a name="API"></a></font></p>
Following is the AMX API for Load balancer administration<b><br>
<br>
LBConfigHelper </b>-
appserv-api\src\java\com\sun\appserv\management/helper/LBConfigHelper .
This is the AMX API which the clients use to administer most of the
load-balancer elements in the domain.xml. <br>
<span style="font-weight: bold;">Loadbalancer</span><b> </b>-
appserv-api\src\java\com\sun\appserv\management\ext\lb\LoadBalancer.java,
this is the AMX code to do some of the new Load balancer configuration
(apply lb-changes,
ping-connection)<br>
<br>
<span style="font-weight: bold;">Others</span><br>
<b><br>
MBeans </b>- /<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee">admin-ee</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin">lb-admin</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src">src</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java">java</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com">com</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun">sun</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise">enterprise</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee">ee</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin">admin</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin/lbadmin">lbadmin</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin/lbadmin/mbeans">mbeans</a>/
contains the MBean interface and implementation to manage
Load Balancer configuration.<br>
<b>Reader </b>- /<a set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee">admin-ee</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin">lb-admin</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src">src</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java">java</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com">com</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun">sun</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise">enterprise</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee">ee</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin">admin</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin/lbadmin">lbadmin</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin/lbadmin/reader">reader</a>
. contains the code that reads the config elements in
domain.xml<br>
<b>Transform</b>&nbsp;
- /<a set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee">admin-ee</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin">lb-admin</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src">src</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java">java</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com">com</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun">sun</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise">enterprise</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee">ee</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin">admin</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin/lbadmin">lbadmin</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin/lbadmin/transform">transform</a>/
. contains the code that implements the <span
 style="font-weight: bold;">Visitors</span>, which visit the above
readers and populate the elements in loadbalancer.xml<br>
<b>schema2beans </b>- We read information from loadbalancer.xml using
schema2beans. These
generated schema2beans are in&nbsp; /<a set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee">admin-ee</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin">lb-admin</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src">src</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java">java</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com">com</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun">sun</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise">enterprise</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee">ee</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin">admin</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin/lbadmin">lbadmin</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin/lbadmin/beans">beans</a>/<br>
<span style="font-weight: bold;">Writer </span>- /<a set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee">admin-ee</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin">lb-admin</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src">src</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java">java</a>/<a
 set="yes"
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com">com</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun">sun</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise">enterprise</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee">ee</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin">admin</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin/lbadmin">lbadmin</a>/<a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin/lbadmin/writer">writer</a>/
. The logic to the configuration to loadbalancer.xml is in <a
 href="http://fisheye5.cenqua.com/browse/glassfish/admin-ee/lb-admin/src/java/com/sun/enterprise/ee/admin/lbadmin/writer">Writer</a>
. <br>
<br>
<p><font size="4"><a name="Examples"><b>Examples</b></a></font></p>
To create load-balancer configuration<br>
<div style="margin-left: 40px;">new<b> LBConfigHelper</b>(domainRoot).<b>createLoadBalancer</b>(lbName,
target, getLBParams(), LBProperties);<br>
<br>
</div>
<span style="font-weight: bold;"></span>
To delete a load-balancer configuration<br>
<div style="margin-left: 40px;">new
<span style="font-weight: bold;">LBConfigHelper</span>(domainRoot).<span
 style="font-weight: bold;">removeLoadbalancer</span>(lbName);
</div>
<br>
To get a list of load-balancer configurations<br>
<div style="margin-left: 40px;">Map lbMap =
domainConfig.<span style="font-weight: bold;">getLoadBalancerConfigMap</span>();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for
(Object key : lbMap.keySet()) System.out.println((String)key);<br>
</div>
<br>
To ping the Load balancer plugin for a secure connection (used for
pushing the loadbalancer.xml and getting the monitoring data)<br>
<div style="margin-left: 40px;">domainRoot.getLoadBalancerMap().get(lbName).<span
 style="font-weight: bold;">testConnection</span>()<br>
<br>
</div>
To apply the load-balancer changes<br>
<div style="margin-left: 40px;">domainRoot.getLoadBalancerMap().get(lbName).<span
 style="font-weight: bold;">applyLBChanges</span>()<br>
</div>
<h2> </h2>
To configure the weights for instances in a cluster<br>
<div style="margin-left: 40px;">new
LBConfigHelper(domainRoot).<span style="font-weight: bold;">configureLBWeight</span>(clusterName,
instanceWeights);<br>
</div>
<br>
To create a load-balancer reference to an existing lb-configuration (a
domain.xml element)<br>
<div style="margin-left: 40px;">new
LBConfigHelper(domainRoot).<span style="font-weight: bold;">createLBRef</span>(lbName,
configName, target,
mOptions);<br>
</div>
<br>
To delete a load-balancer reference from an existing lb-configuration
(a domain.xml element)<br>
<div style="margin-left: 40px;">new
LBConfigHelper(domainRoot).<span style="font-weight: bold;">removeLBRef</span>(lbName,
configName, target,
mOptions);<br>
</div>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<div style="margin-left: 40px;"><br>
<br>
<br>
</div>
</body>
</html>
