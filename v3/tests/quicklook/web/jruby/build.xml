<?xml version="1.0" encoding="UTF-8"?>

<project name="jruby-test" default="all" basedir=".">

<property file="build.properties"/>
<property file="${ws.root}/build.properties"/>
<property name="JRUBY_HOME" value="${jruby_path}/jruby-all-1.1.3"/>
 
<description>Builds, tests, and runs the JRuby Applications</description>
    <import file="${ws.root}/gfproject/build-impl.xml"/>
    <import file="${ws.root}/gfproject/v3-targets.xml"/>

<target name="all" depends="setup-jruby,set-jrubyhome,deploy,runtest,undeploy"/>

<target name="setJRubyCon">
   <available file="${JRUBY_HOME}" type="dir" property="local.jruby.present"/>
</target>

<target name="setup-jruby" depends="setJRubyCon" unless="local.jruby.present">
   <unzip src="${jruby_path}/jruby-all-1.0-1.1.3.zip" dest="${jruby_path}"/>
   <chmod dir="${JRUBY_HOME}/bin" perm="ugo+rx" 
       includes="**/*"/>
</target>

<target name="deploy">
   <antcall target="deploy-v3-impl">
      <param name="deployed.app" value="helloapp"/>
   </antcall>
</target>

<target  name="runtest">
   <antcall target="runtest-impl">
       <param name="testng.test.name" value="${testng.test.name}"/>
       <param name="testng.testclient" value="JRubyTestNG"/>
   </antcall>
</target>

<target name="undeploy">
   <antcall target="undeploy-v3-impl"/>
</target>
    
</project>
