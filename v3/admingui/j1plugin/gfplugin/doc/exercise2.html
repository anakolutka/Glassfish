<html>
    <head></head>
    <body>
	<div class="j1holcontents">

	    <h1>Exercise 2: Charting with jMaki</h1>

	    <div class="j1holduration xbig">Approximate duration: 25 minutes</div>

	    <p class="j1holheader">Introduction:</p>

	    <p>
		The goal of this exercise is to create a JSF page which utilizes the jMaki
  Charting component and create another integration point to the Administration
  Console.  Through this exercise you will learn how to include a
  jMaki widget in a JSF page and add another plugin to the Administration
  Console.
	    </p>

	    <p class="j1holheader">Background Information:</p>

	    <p>
		<font color=#ff0000>TBD:</font> More info relating to jMaki
	    </p>

			<div class="j1holtip">This exercise is based on Exercise 1.  If you have not completed exercise 1 do the following so that you can continue with Exercise 2<br>
<code>
	% mv gfplugin/myplugin gfplugin/myplugin.save<br>
	% mkdir gfplugin/myplugin <br>
	% cp -R gfplugin/solution/myplugin/ex1 gfplugin/myplugin<br></code>
    </div>


<a name="ex2steps">
    <p class="j1holheader">Step-by-Step Instructions:</p>
</a>

    <p class="j1holsubheader">Overview:</p>

<p> In this excercise, you will complete the following:</p>

    <ol class="j1hollist" style="list-style-type: upper-alpha;">
	<li><b><a href="#ex2stepA">Create a jMaki Charting page</a></b>
	    <p>
		You will create a JSFTemplating JavaServer Faces pages that contains a jMaki Charting component
	    </p></li>
	<li><b><a href="#ex2stepB">Modify your console-config.xml </a></b>
	    <p>
You will modify your configuration file to add a new IntegrationPoint
	    </p></li>
	<li><b><a href="#ex2stepC">Specify your Tree Node layout</a></b>
	    <p>
In this step you will add the file "treenode-ex2.jsf" for specifying the new tree node that points to the jMaki Charting page
	    </p></li>

	<li><b><a href="#ex2stepD">Build and Install your first GlassFish v3 plugin</a></b>
	    <p>
In this step you will install and test your plugin.
	    </p></li>
    </ol>
	<br>


<p class="j1holsubheader">Steps:</p>

	<a name="ex2stepA">
	    <b>A. Create a jMaki Charting page </b>
	</a>
<!-- FIXME: Explain what happens in this step -->

<a name="FigChartPage">
<div class="codebox">
<pre>
&lt;sun:page&gt;
    &lt;!beforeCreate
	getjMakiValues(values=&gt;$attribute{pievalues});
	getjMakiValues(values=&gt;$attribute{gryvalues});
	getjMakiValues(values=&gt;$attribute{bluvalues});
	getjMakiValues(values=&gt;$attribute{pnkvalues});
	getjMakiValues(values=&gt;$attribute{redvalues});
    /&gt;
    &lt;sun:html&gt;
    &lt;sun:markup tag="head"&gt;
	&lt;sun:link url="/theme/com/sun/webui/jsf/suntheme/css/css_master.css" /&gt;
	&lt;sun:markup tag="title"&gt;
	    &lt;staticText value="jMaki Charting!" /&gt;
	&lt;/sun:markup&gt;
	&lt;sun:script url="/resources/jmaki.js" /&gt;
	&lt;sun:script url="/theme/META-INF/dojo/dojo.js" /&gt;
	&lt;sun:script url="/theme/META-INF/json/json.js" /&gt;
	&lt;sun:script url="/theme/META-INF/prototype/prototype.js" /&gt;
	&lt;sun:script url="/theme/META-INF/com_sun_faces_ajax.js" /&gt;
    &lt;/sun:markup&gt;

&lt;sun:markup tag="body"&gt;

&lt;sun:form id="form"&gt;


&lt;sun:markup tag="div" style="width:380px; height: 310px;"&gt;

&lt;sun:dropDown labels={"jmaki.charting.yahoo.pie"
	"jmaki.charting.google.pie"
	"jmaki.charting.plotkit.pie"}
	value="#{requestScope.chart1}"&gt;
    &lt;!beforeCreate
    setAttribute(key="chart1", value="jmaki.charting.google.pie");
    /&gt;
&lt;/sun:dropDown&gt;
&lt;sun:button value=" Refresh " /&gt;
&lt;jmaki:widget name="#{requestScope.chart1}"
    args="{colorScheme:2}"
    value="{
    xAxis : {
	title : 'Months',
	labels : [
	{label : 'January'},
	{label : 'February'},
	{label : 'March'},
	{label : 'April'},
	{label : 'May'},
	{label : 'June'},
	{label : 'July'},
	{label : 'August'},
	{label : 'September'},
	{label : 'October'},
	{label : 'November'},
	{label : 'December'} ]
	},
    data : [ {
	label : 'Set 1',
	values : $attribute{pievalues}
	} ] }"/&gt;

&lt;/sun:markup&gt;

&lt;sun:dropDown labels={"jmaki.charting.plotkit.area"
	"jmaki.charting.plotkit.line"
	"jmaki.charting.plotkit.bar"
	"jmaki.charting.google.area"
	"jmaki.charting.google.bar"
	"jmaki.charting.google.line"
	"jmaki.charting.yahoo.line"
	"jmaki.charting.yahoo.bar"
	"jmaki.charting.dojo.bar"
	"jmaki.charting.dojo.line"
	"jmaki.charting.dojo.area"}
	value="#{requestScope.chart2}"&gt;
    &lt;!beforeCreate
    setAttribute(key="chart2", value="jmaki.charting.yahoo.bar");
    /&gt;
&lt;/sun:dropDown&gt;
&lt;sun:button value=" Refresh " /&gt;
&lt;sun:markup tag="div" style="width: 500px; height: 280px;"&gt;

&lt;jmaki:widget name="#{requestScope.chart2}"
	value="{
	    xAxis : {
		title : 'Months',
		labels : [{ label : 'January'},
		    { label : 'February'},
		    { label : 'March'},
		    { label : 'April'},
		    { label : 'May'},
		    { label : 'June'},
		    { label : 'July'},
		    { label : 'August'},
		    { label : 'September'},
		    { label : 'October'},
		    { label : 'November'},
		    { label : 'December'}
		    ]
		    },
	    yAxis : {
		title : 'Temperature',
		labels : [{ label : '0', value : 0},
		    { label : '10s', value : 10},
		    { label : '20s', value : 20},
		    { label : '30s', value : 30},
		    { label : '40s', value : 40},
		    { label : '50s', value : 50}
		    ]
		    },
	    data : [
		    {label : 'Gray Series', values : $attribute{gryvalues} },
		    {label : 'Pink Series', values : $attribute{pnkvalues} },
		    {label : 'Blue Series', values : $attribute{bluvalues} },
		    {label : 'Red Series',  values : $attribute{redvalues} }
		    ]
		    }"/&gt;
	&lt;/sun:markup&gt;
	&lt;/sun:form&gt;
	&lt;/sun:markup&gt;
	&lt;/sun:html&gt;
&lt;/sun:page&gt;
</pre>
</div>
<div class="figure">Figure 2-1: TBD</div>
</a>

	<p>You should have <code>myplugin project</code> still open in
NetBeans. If you have closed the project, follow these steps to open
it again. More detailed instructions can be found in <a href="#Exercise_1=ex1stepA">exercise 1-A </a>

    <ol class="j1hollist">
	<li>Launch NetBeans IDE 6.0.</li>
	<li>Open <code>myplugin</code> module:
	    <ol class="j1hollis">
		<li> Choose Open Project from the File menu.</li>
		<li> Browse to <code>gfplugin</code> and select <code>myplugin</code> module.</li>
		<li> Press the Open Project button.  Your NetBeans <code>Projects</code> tab should show:
		    <p>	<img src="images/ex2-project-open.jpg"></p>
		    <div class="figure">Figure 2-1: Opened myplugin module to start exercise 2.</div>
		</li>
	    </ol>
	</li>
	<li>Create a page showing a jMaki chart:
	    <ol class="j1hollist">
		<li>Select Other Sources -&gt; resources.</li>
		<li>Create an empty file named 'chart.jsf'</li>
		<li>Use <a href="#FigChartPage">Figure TBD</a> as the content for chart.jsf.
		    <p> <img src=images/ex2-editChart.jpg></p>
		    <div class="figure">Figure 2-2: Edit chart.jsf.</div>
		</li>
	    </ol>
	</li>
   </ol>


<hr style="WIDTH:100%; HEIGHT:2px"><br>

<a name="ex2stepB">
    <b>B. Modify your console-config.xml </b>
</a>
<p> You now need to add an <code>IntegrationPoint</code> for plugging the
    Exercise 2 tree node into the Administration Console. Each plugin module
    should have 1 <code>console-config.xml</code>, and you can specify as
    many <code>IntegrationPoint</code>s as needed in this configuration file.
    Since you have created this file in Exercise 1, all you need to do now is
    to edit it and add the second <code>IntegrationPoint</code>.  You want the
    Exercise 2 tree node to be under the JavaOne tree node.  So, you must
    specify the <code>parentId</code> to be "<code>j1root</code>". You can
    refer to <a href="#FIXME">treenode-ex1.jsf</a> to see this.  You also
    need to create the file <code>treenode-ex2.jsf</code> which will point to
    the JSF jMaki chart page.

<a name="figIntPoint">
<div class="codebox">
  <pre>
&lt;integration-point
	id="Another"
	type="tree"
	priority="230"
	parentId="j1root"
	content="treenode-ex2.jsf"
/&gt;
</pre>
</div>
<div class="figure">Figure 2-1: TBD</div>
</a>
</p>

    <ol class="j1hollist">
	<li>Double click on <code><b>console-config.xml</b></code> under
	    Other Sources --&gt; resources --&gt; META-INF --&gt; admingui</li>

	<li>Add the <code>IntegrationPoint</code> declaration as shown in <a href="#figIntPoint">Figure TBD</a> to your
	    <code>console-config.xml</code> file.

	    <p>	<img src=images/ex2-editConfig.jpg></p>
	    <div class="figure">Figure 2-3: Modified console-config.xml file.</div>
	</li>
    </ol>

<hr style="WIDTH:100%; HEIGHT:2px"><br>

<a name="ex2stepC">
    <b>C. Specify your Tree Node layout</a></b>
</a>

<p> You will need to create <code>exercise-2.jsf</code>, which is specfied as
    the "content" of your new <code>IntegrationPoint</code>.

<a name="figNewTreeNode">
<div class="codebox">
    <pre>
&lt;sun:treeNode
	id="second"
	text="Exercise #2"
	url="javaone/chart.jsf"
	imageURL="resource/images/instance.gif"
	target="main"
/&gt;
    </pre>
</div>
<div class="figure">Figure 2-1: TBD</div>
</a>
</p>

<ol class="j1hollist">
    <li>Select Other Sources --&gt; resources.</li>
    <li>Create an empty file named <code>treenode-ex2.jsf</code> under "resources".</li>
    <li>Edit <code>treenode-ex2.jsf</code> to specify the information regarding this second tree node.
	<p> <img src=images/ex2-editTreenode.jpg></p>
	<div class="figure">Figure 2-4: Edit of treenode-ex2.jsf</div>
    </li>
</ol>

<hr style="WIDTH:100%; HEIGHT:2px">

<a name="ex2stepD">
    <b>D. Build and Install your first GlassFish v3 plugin</b>
</a>
<ol class="j1hollist">
    <li><p> Build the project.</p>

<p> Note: If you are using a command line and have 'maven 2' installed on
    your system you can build the project by doing the following:

<div class="console"><pre>
cd gfplugin/plugin
mvn install
</pre>
</div>

<p> To build using NetBeans:</p>

<ol class="j1hollist">
    <li>Right click on your "Java One 2008 Admin Console Plugin" project.</li>
    <li>Select Build.</li>
</ol>

<p> After the above steps are finished, you will have the jar file named
		<code>gfplugin/myplugin/target/console-myplugin-1.0-SNAPSHOT.jar</code>.
		This jar file is ready to be integrated into GlassFish.</span><br>
    </li>
    <li><p> Install your plugin in GlassFish v3</p>

	<p> You now need a Terminal to enter some commands. Please bring
	    up a terminal window.</p>

	<p> The GlassFish v3 server is installed in the
	    <code>gfplugin/glassfish</code> directory.  The following steps
	    show you how to integrate and test your plugin module.</p>

	<ol class="j1hollist">
	    <li>Go to your <code>gfplugin</code> directory.
<div class="console">
<pre>
cd &lt;path-to-gfplugin&gt;
</pre>
</div>
		</li>
	    <li>Shut down the server which may have been started in
		<a href="#Exercise_1">Exercise 1</a>
<!-- FIXME: Remove magic script... lets use the real thing unless we make them make the script -->
<div class="console">
<pre>
glassfish/bin/stop-domain
</pre>
</div>
	    </li>
	    <li>Integrate your plugin into GlassFish by copying it to the GlassFish modules directory:
<div class="console">
<pre>
cp myplugin/target/console-myplugin-1.0-SNAPSHOT.jar glassfish/modules/console-myplugin-1.0-SNAPSHOT.jar
</pre>
</div>
	    </li>
	    <li>Start GlassFish:<br>
<div class="console">
<pre>
glassfish/bin/asadmin start-domain
</pre>
</div>
	    </li>
	    <li>Type "<code><b>http://localhost:8080/admingui/index.jsf</b></code>"
		into your browser to bring up the GlassFish Administration
		Console.</li>
	    <li>Expand the JavaOne tree node in the navigation tree, note your
		new tree node "<code>Exercise #2</code>" has been added.  Click
		the "<code>Exercise #2</code>" tree node to display your chart
		page.
		<p> <img src="images/ex2-result.jpg"></p>
		<div class="figure">Figure 2-5: Browser showing the plugin page with charts.</div>
		</li>
	    </ol>
			 <p>You have customized the Administration Console and
		  plugged in your own tree node to show the jMaki Charts.
				  <br>
					Try to change the dropdown box to select another charting style
		  </p>

<hr style="WIDTH:100%; HEIGHT:2px"><br>

<p class="j1holheader">Summary:</p>

<p> In this exercise, you created a JSFTemplating page with jMaki Chart.  You
    added a new <code>IntegrationPoint</code> to your GlassFish plugin module
    which added an additional tree node. Clicking on this tree node navigated
    to your newly added chart page.</p>

	    <p><a href="#Solution_2">Go to solution</a></p>
	    <p><a href="#Exercise_1">Go back to previous exercise</a></p>
	    <p><a href="#Exercise_3">Go on to next exercise</a></p>
	</div>
    </body>
</html>
