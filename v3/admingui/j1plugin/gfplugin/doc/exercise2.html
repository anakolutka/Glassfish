<html>
    <head></head>
    <body>
	<div class="j1holcontents">

	    <h1>Exercise 2: Charting with jMaki</h1>

	    <div class="j1holduration xbig">Approximate duration: 25 minutes</div>

	    <p class="j1holheader">Introduction:</p>

	    <p> The goal of this exercise is to create a JSF page which
		utilizes the jMaki Charting component and link the page to the
		GlassFish Administration Console by adding another tree node in
		the GlassFish Administration Console.  When you have completed
		this exercise, your plugin will resemble the following
		image:</p>

	    <p> <img src="images/ex2-result.jpg"></p>
	    <div class="figure">Figure 2-1: Browser showing the plugin page with charts.</div>

	    <p> In this exercise you will learn the following concepts:</p>

	    <ul class="j1hollist">
		<li>How to add jMaki widget to a JSF page.</li>
		<li>How to add a plugin to the Administration Console that
		    links to another plugin <code>IntegrationPoint</code>.</li>
	    </ul>

	    <p>	To learn background information about jMaki, proceed to the
		<a href="#ex2background">next section</a>.  To begin creating
		the jMaki Charting JavaServer Faces page immediately, proceed
		to the <a href="#ex2steps">Step-by-Step Instructions</a>.</p>

<a name="ex2background">
	    <p class="j1holheader">Background Information:</p>
</a>

	    <p>
	    jMaki charting provides dynamic charting capabilities where charts can be manipulated on the client without round trips to the server.  Chart manipulation is handled through the jMaki publish and subscribe mechanism.  jMaki  provides a common API to the following JavaScript Charting packages, Plotkit, Dojo, Yahoo and Google.  Developers can quickly represent their data using bar, line or area charts.
	    </p>

<div class="j1holtip">You will need Exercise 1 completed in order to continue with Exercise 2.  If you have
not completed Exercise 1 you can perform the following commands below to copy the solution.</div>
<font color=#ff0000><b>Warning! By copying the solution you will no longer see any work you completed in exercise 2. </b></font></p>
<div class="console"><pre>
mv gfplugin/myplugin gfplugin/myplugin.save
mkdir gfplugin/myplugin
cp -R gfplugin/solution/myplugin/ex1 gfplugin/myplugin
</pre></div>




<a name="ex2steps">
    <p class="j1holheader">Step-by-Step Instructions:</p>
</a>

    <p class="j1holsubheader">Overview:</p>

<p> In this excercise, you will complete the following:</p>

    <ol class="j1hollist" style="list-style-type: upper-alpha;">
	<li><b><a href="#ex2stepA">Create a jMaki Charting page</a></b>
	    <p>
		You will create a JSFTemplating JavaServer Faces pages that contains a jMaki Charting component
	    </p></li>
	<li><b><a href="#ex2stepB">Modify your console-config.xml </a></b>
	    <p>
You will modify your configuration file to add a new <code>IntegrationPoint</code>
	    </p></li>
	<li><b><a href="#ex2stepC">Specify your Tree Node layout</a></b>
	    <p>
In this step you will add the file "treenode-ex2.jsf" for specifying the new tree node that points to the jMaki Charting page
	    </p></li>

	<li><b><a href="#ex2stepD">Build and Install your first GlassFish v3 plugin</a></b>
	    <p>
In this step you will install and test your plugin.
	    </p></li>
    </ol>
	<br>


<p class="j1holsubheader">Steps:</p>

	<a name="ex2stepA">
	    <b>A. Create a jMaki Charting page </b>
	</a>
<!-- FIXME: Explain what happens in this step -->

<a name="FigChartPage">
<div class="codebox">
<pre>
&lt;sun:page&gt;
&lt;sun:html&gt;
    &lt;sun:head title="chart" /&gt;
    &lt;sun:body&gt;
        &lt;sun:form id="form"&gt;

&lt;!-- Pie Chart --&gt;
&lt;sun:markup tag="div" style="width:380px; height: 310px;"&gt;
&lt;jmaki:widget name="jmaki.charting.plotkit.pie"
    args="{colorScheme:4}"
    value="{
    xAxis : {
        title : 'Months',
        labels : [
        {label : 'January'},
        {label : 'February'},
        {label : 'March'},
        {label : 'April'},
        {label : 'May'},
        {label : 'June'},
        {label : 'July'},
        {label : 'August'},
        {label : 'September'},
        {label : 'October'},
        {label : 'November'},
        {label : 'December'} ] },
    data : [ {
        label : 'Set 1',
        values : [25, 45, 25, 45, 50, 25, 35, 25, 25, 20, 35, 45]
        } ] }" /&gt;
&lt;/sun:markup&gt;

&lt;!-- Area Chart --&gt;
&lt;sun:markup tag="div" style="width: 500px; height: 280px;"&gt;
&lt;jmaki:widget name="jmaki.charting.dojo.area"
    value="{
        xAxis : {
            title : 'Months',
            labels : [{ label : 'January'},
                { label : 'February'},
                { label : 'March'},
                { label : 'April'},
                { label : 'May'},
                { label : 'June'},
                { label : 'July'},
                { label : 'August'},
                { label : 'September'},
                { label : 'October'},
                { label : 'November'},
                { label : 'December'} ] },
        yAxis : {
            title : 'Temperature',
            labels : [{ label : '0', value : 0},
                { label : '10s', value : 10},
                { label : '20s', value : 20},
                { label : '30s', value : 30},
                { label : '40s', value : 40},
                { label : '50s', value : 50} ] },
        data : [{label : 'Gray Series', values : [65, 45, 15, 45, 50, 25, 3, 25, 35, 27, 35, 39] },
                {label : 'Pink Series', values : [25, 45, 50, 5, 45, 35, 25, 35, 25, 29, 27, 25] },
                {label : 'Blue Series', values : [45, 50, 25, 35, 2, 45, 45, 55, 45, 47, 31, 41] },
                {label : 'Red Series',  values : [20, 12, 4, 7, 5, 19, 35, 11, 20, 30, 15, 7] } ] }"/&gt;
&lt;/sun:markup&gt;

        &lt;/sun:form&gt;
    &lt;/sun:body&gt;
&lt;/sun:html&gt;
&lt;/sun:page&gt;
</pre>
</div>
<br />
<div class="figure">Figure 2-2: chart.jsf</div>
</a>

	<p>You should have <code>myplugin</code> project still open in
NetBeans. If you have closed the project, follow these steps to open
it again. More detailed instructions can be found in <a href="#Exercise_1=ex1stepA">exercise 1-A </a>

    <ol class="j1hollist">
	<li>Launch NetBeans IDE 6.0.</li>
	<li>Open <code>myplugin</code> module:
	    <ol class="j1hollis">
		<li> Choose <b>Open Project</b> from the File menu.</li>
		<li> Browse to <b>gfplugin</b> and select <b>myplugin</b> module.</li>
		<li> Press the <b>Open Project button</b>.  Your NetBeans <b>Projects</b> tab should show:
		</li>
	    </ol>
			<p>
			<a href="images/ex2-project-open.jpg"><img style="border: 1px solid ; width: 700px; height: 405;" alt="" src="images/ex2-project-open.jpg"></a>
			</p>
		    <div class="figure">Figure 2-3: Open myplugin module.</div>
	</li>
	<li>Create a page showing a jMaki chart:
	    <ol class="j1hollist">
		<li>Select <b>Other Sources --&gt; resources</b>.</li>
		<li>Create an empty file named "<codee>chart.jsf</code>".</li>
		<li>Use <a href="#FigChartPage">Figure 2.2</a> as the content for chart.jsf.  </li>
	    </ol>
		<p>
		<a href="images/ex2-editChart.jpg"><img style="border: 1px solid ; width: 700px; height: 405;" alt="" src="images/ex2-editChart.jpg"></a>
		</p>
		    <div class="figure">Figure 2-4: Edit chart.jsf.</div>
	</li>
   </ol>


<hr style="WIDTH:100%; HEIGHT:2px"><br>

<a name="ex2stepB">
    <b>B. Modify your console-config.xml </b>
</a>
<p> You now need to add an <code>IntegrationPoint</code> for plugging the
    Exercise 2 tree node into the Administration Console. Each plugin module
    should have 1 <code>console-config.xml</code>, and you can specify as
    many <code>IntegrationPoint</code>s as needed in this configuration file.
    Since you have created this file in Exercise 1, all you need to do now is
    to edit it and add the second <code>IntegrationPoint</code>.  You want the
    Exercise 2 tree node to be under the JavaOne tree node.  So, you must
    specify the <code>parentId</code> to be "<code>j1root</code>". You can
    refer to <a href="#FIXME">treenode-ex1.jsf</a> to see this.  You also
    need to create the file <code>treenode-ex2.jsf</code> which will point to
    the JSF jMaki chart page.

<a name="figIntPoint">
<div class="codebox">
  <pre>
&lt;integration-point 
    id="Another" 
    type="tree" 
    priority="230" 
    parentId="j1root" 
    content="treenode-ex2.jsf" 
/&gt;
</pre>
</div>
<br />
<div class="figure">Figure 2-5: Modify console-config.xml </div>
</a>
</p>

    <ol class="j1hollist">
	<li>Double click on <code><b>console-config.xml</b></code> under
	    Other Sources --&gt; resources --&gt; META-INF --&gt; admingui</li>

	<li>Add the <code>IntegrationPoint</code> declaration as shown in <a href="#figIntPoint">Figure TBD</a> to your
	<code>console-config.xml</code> file. </li>
    </ol>

		<p>
		<a href="images/ex2-editConfig.jpg"><img style="border: 1px solid ; width: 700px; height: 405;" alt="" src="images/ex2-editConfig.jpg"></a>
		</p>
	    <div class="figure">Figure 2-6: Modified console-config.xml file.</div>

<hr style="WIDTH:100%; HEIGHT:2px"><br>

<a name="ex2stepC">
    <b>C. Specify your Tree Node layout</a></b>
</a>

<p> You will need to create <code>exercise-2.jsf</code>, which is specfied as
    the "content" of your new <code>IntegrationPoint</code>.

<a name="figNewTreeNode">
<div class="codebox">
<pre>
&lt;sun:treeNode
    id="second"
    text="Exercise #2"
    url="javaone/chart.jsf"
    imageURL="resource/images/instance.gif"
    target="main"
/&gt;
</pre>
</div>
<br />
<div class="figure">Figure 2-7: Modify treenode-ex2.jsf </div>
</a>
</p>

<ol class="j1hollist">
    <li>Select Other Sources --&gt; resources.</li>
    <li>Create an empty file named <code>treenode-ex2.jsf</code> under "resources".</li>
	<li>Edit <code>treenode-ex2.jsf</code> to specify the information regarding this second tree node. </li>
</ol>
		<p>
		<a href="images/ex2-editTreenode.jpg"><img style="border: 1px solid ; width: 700px; height: 450;" alt="" src="images/ex2-editTreenode.jpg"></a>
		</p>
	<div class="figure">Figure 2-8: Edit of treenode-ex2.jsf</div>
	<p>

<hr style="WIDTH:100%; HEIGHT:2px">

<a name="ex2stepD">
    <b>D. Build and Install your first GlassFish v3 plugin</b>
</a>
<ol class="j1hollist">
    <li><p> Build the project.</p>

<div class="console"><pre>
cd gfplugin/myplugin
mvn install
</pre>
</div>

<p> After the above steps are finished, you will have the jar file named
		<code>gfplugin/myplugin/target/console-myplugin-1.0.jar</code>.
		This jar file is ready to be integrated into GlassFish.</span><br>
    </li>
    <li><p> Install your plugin in GlassFish v3</p>

	<p> You now need a Terminal to enter some commands. Please bring
	    up a terminal window.</p>

	<p> The GlassFish v3 server is installed in the
	    <code>gfplugin/glassfish</code> directory.  The following steps
	    show you how to integrate and test your plugin module.</p>

	<ol class="j1hollist">
	    <li>Go to your <code>gfplugin</code> directory.
<div class="console">
<pre>
cd &lt;path-to-gfplugin&gt;
</pre>
</div>
		</li>
	    <li>Shut down the server which may have been started in
		<a href="#Exercise_1">Exercise 1</a>
<!-- FIXME: Remove magic script... lets use the real thing unless we make them make the script -->
<div class="console">
<pre>
glassfish/bin/stop-domain
</pre>
</div>
	    </li>
	    <li>Integrate your plugin into GlassFish by copying it to the GlassFish modules directory:
<div class="console">
<pre>
cp myplugin/target/console-myplugin-1.0.jar glassfish/modules/console-myplugin-1.0.jar
</pre>
</div>
	    </li>
	    <li>Start GlassFish:<br>
<div class="console">
<pre>
glassfish/bin/asadmin start-domain
</pre>
</div>
	    </li>
            <li>In the browser enter the following URL to bring up the Administration Console:
                <div class="codebox"><pre>http://localhost:8080/admingui/index.jsf</pre></div>
	    <li>Expand the JavaOne tree node in the navigation tree, note your
		new tree node "<code>Exercise #2</code>" has been added.  Click
		the "<code>Exercise #2</code>" tree node to display your chart
		page.
		</li>
	    </ol>
		<p> <img src="images/ex2-result.jpg"></p>
		<div class="figure">Figure 2-9: Browser showing the plugin page with charts.</div>
		<br>

<hr style="WIDTH:100%; HEIGHT:2px"><br>

<p class="j1holheader">Summary:</p>

<p> In this exercise, you created a JSFTemplating page with jMaki Chart.  You
    added a new <code>IntegrationPoint</code> to your GlassFish plugin module
    which added an additional tree node. Clicking on this tree node navigated
    to your newly added chart page.</p>

	    <p><a href="#Solution_2">Go to solution</a></p>
	    <p><a href="#Exercise_1">Go back to previous exercise</a></p>
	    <p><a href="#Exercise_3">Go on to next exercise</a></p>
	</div>
    </body>
</html>
