<html>
<head>
</head>
<body>
<div class="j1holcontents">

<h1>Exercise 3: Templating your Plugin</h1>

<div class="j1holduration xbig">Approximate duration: 25 minutes</div>

<p class="j1holheader">Introduction:</p>

<p> In this exercise you will incorporate the previous exercises. You will
    also use a template to help you create a new JavaServer Faces page. The
    template helps you to layout your page and allows you to focus on providing
    the content.  At the completion of this lab your GlassFish v3 Aministration
    Console plugin will look like this:</p>

<p> <img src="images/ex3-result.jpg"></p>
<div class="figure">Figure 3-1: Exercise 3 Completed.</div>

<p> In this exercise you will:</p>

<ul class="j1hollist">
    <li>Create a JSF page which utilizes a template and shows a jMaki chart.</li>
    <li>Add another tree node to the Administration Console via an IntegrationPoint.</li>
    <li>Access the GlassFish v3 Administration Console and see the jMaki Charts page with customized header.</li>
</ul>

<p> To learn background information about using template in JavaServer Faces,
    proceed to the <a href="#ex3background">next section</a>.  To begin using
    a template to create a JavaServer Faces page immediately, proceed to the
    <a href="#ex3steps">Step-by-Step Instructions</a>.</p>

<a name="ex3background">
<p class="j1holheader">Background Information:</p>
</a>

<p> JSFTemplating makes building pages and components easier.  When creating
    pages, often content is repeated many times across multiple pages.  Using
    templates you can easily reuse your code and make it much easier to
    maintain.</p>

    <font color=#ff0000>TBD:</font> More info relating to Templating.
</p>


<div class="j1holtip">You will need Exercise 2 completed in order to continue with Exercise 3.  If you have
not completed Exercise 2 you can perform the following commands below to copy the solution.</div>
<font color=#ff0000><b>Warning! By copying the solution you will no longer see any work you completed in exercise 2. </b></font></p>
<div class="console"><pre>
mv gfplugin/myplugin gfplugin/myplugin.save
mkdir gfplugin/myplugin
cp -R gfplugin/solution/myplugin/ex2 gfplugin/myplugin
</pre></div>



<a name="ex3steps">
    <p class="j1holheader">Step-by-Step Instructions:</p>
</a>

<p class="j1holsubheader">Overview:</p>

<p> In this excercise, you will complete the following:</p>
<a name="ex3contents">
    <ol class="j1hollist" style="list-style-type: upper-alpha;">
	<li><b><a href="#ex3stepA">Create a jMaki Charting Page within a Template.</a></b>
	    <p> You will create a JSFTemplating page that contains a jMaki
		Charting component within a template.</p></li>
	<li><b><a href="#ex3stepB">Modify Your console-config.xml.</a></b>
	    <p> You will modify your <code>console-config.xml</code>
		configuration file to add a new
		<code>IntegrationPoint</code>.</p></li>
	<li><b><a href="#ex3stepC">Specify Your Tree Node layout.</a></b>
	    <p> In this step you will add the file
		"<code>treenode-ex3.jsf</code>" to specify a new tree
		node to point to the new jMaki Charting page.</p></li>
	<li><b><a href="#ex3stepD">Build and Install Your GlassFish v3 Plugin.</a></b>
	    <p>In this step you will install and test your plugin.</p></li>
    </ol>
</a>

<br />
<p class="j1holsubheader">Steps:</p>

<a name="ex3stepA">
    <p><b>A. Create a jMaki Charting Page within a Template</b><p>
</a>

<p>You should have <code>myplugin</code> project still open in
NetBeans. If you have closed the project, follow these steps to open
it again.</p>

<ol class="j1hollist">
<li><b>Open the plugin module in NetBeans</b>
    <ol class="j1hollist">
	<li>Launch NetBeans IDE 6.0.</li>
	<li>Open plugin module.
	    <ol class="j1hollist">
		<li>Choose <b>Open Project</b> from the <b>File</b> menu.</li>
		<li>Browse to <b>gfplugin</b> and select <b>myplugin</b>.</li>
		<li>Press the <b>Open Project</b> button.
		    <p>&nbsp;</p>
		    <p><img src="images/ex3-open-project.jpg" /></p>
		    <div class="figure">Figure 3-2: Open Project myplugin</div>
		</li>
	    </ol>
	</li>
    </ol>
</li>

<li><b><a name="ex3stepA2">Create a page showing a jMaki chart in a template.</b>
    <p>	In this step, you will create a JSF page based on a template, and add
	the jMaki Charting component to it.  Notice the only change compared to
	<a href="#Exercise_2=FigChartPage">"<code>chart.jsf</code>" in
	exercise #2</a> is the use of template <code>javaOneTemplate.tpl</code>.
	The template defines parts of the page that are shared across multiple
	pages and allows our page to contain much less redundant code.</p>

<a name="chart3">
	    <div class="codebox">
		<pre>
&lt;!composition template="templates/javaOneTemplate.tpl"&gt;
&lt;!define name="content"&gt;

  &lt;sun:page&gt;
    &lt;!beforeCreate
	getjMakiValues(values=&gt;$attribute{pievalues});
	getjMakiValues(values=&gt;$attribute{gryvalues});
	getjMakiValues(values=&gt;$attribute{bluvalues});
	getjMakiValues(values=&gt;$attribute{pnkvalues});
	getjMakiValues(values=&gt;$attribute{redvalues});
    /&gt;
    &lt;sun:html&gt;
    &lt;sun:markup tag="head"&gt;
	&lt;sun:link url="/theme/com/sun/webui/jsf/suntheme/css/css_master.css" /&gt;
	&lt;sun:markup tag="title"&gt;
	    &lt;staticText value="jMaki Charting!" /&gt;
	&lt;/sun:markup&gt;
	&lt;sun:script url="/resources/jmaki.js" /&gt;
	&lt;sun:script url="/theme/META-INF/dojo/dojo.js" /&gt;
	&lt;sun:script url="/theme/META-INF/json/json.js" /&gt;
	&lt;sun:script url="/theme/META-INF/prototype/prototype.js" /&gt;
	&lt;sun:script url="/theme/META-INF/com_sun_faces_ajax.js" /&gt;
    &lt;/sun:markup&gt;

&lt;sun:markup tag="body"&gt;

&lt;sun:form id="form"&gt;

&lt;sun:markup tag="div" style="width:380px; height: 310px;"&gt;

&lt;sun:dropDown labels={"jmaki.charting.yahoo.pie"
	"jmaki.charting.google.pie"
	"jmaki.charting.plotkit.pie"}
	value="#{requestScope.chart1}"&gt;
    &lt;!beforeCreate
    setAttribute(key="chart1", value="jmaki.charting.google.pie");
    /&gt;
&lt;/sun:dropDown&gt;
&lt;sun:button value=" Refresh " /&gt;
&lt;jmaki:widget name="#{requestScope.chart1}"
    args="{colorScheme:2}"
    value="{
    xAxis : {
	title : 'Months',
	labels : [
	{label : 'January'},
	{label : 'February'},
	{label : 'March'},
	{label : 'April'},
	{label : 'May'},
	{label : 'June'},
	{label : 'July'},
	{label : 'August'},
	{label : 'September'},
	{label : 'October'},
	{label : 'November'},
	{label : 'December'} ]
	},
    data : [ {
	label : 'Set 1',
	values : $attribute{pievalues}
	} ] }"/&gt;

&lt;/sun:markup&gt;

&lt;sun:dropDown labels={"jmaki.charting.plotkit.area"
	"jmaki.charting.plotkit.line"
	"jmaki.charting.plotkit.bar"
	"jmaki.charting.google.area"
	"jmaki.charting.google.bar"
	"jmaki.charting.google.line"
	"jmaki.charting.yahoo.line"
	"jmaki.charting.yahoo.bar"
	"jmaki.charting.dojo.bar"
	"jmaki.charting.dojo.line"
	"jmaki.charting.dojo.area"}
	value="#{requestScope.chart2}"&gt;
    &lt;!beforeCreate
    setAttribute(key="chart2", value="jmaki.charting.yahoo.bar");
    /&gt;
&lt;/sun:dropDown&gt;
&lt;sun:button value=" Refresh " /&gt;
&lt;sun:markup tag="div" style="width: 500px; height: 280px;"&gt;

&lt;jmaki:widget name="#{requestScope.chart2}"
	value="{
	    xAxis : {
		title : 'Months',
		labels : [{ label : 'January'},
		    { label : 'February'},
		    { label : 'March'},
		    { label : 'April'},
		    { label : 'May'},
		    { label : 'June'},
		    { label : 'July'},
		    { label : 'August'},
		    { label : 'September'},
		    { label : 'October'},
		    { label : 'November'},
		    { label : 'December'}
		    ]
		    },
	    yAxis : {
		title : 'Temperature',
		labels : [{ label : '0', value : 0},
		    { label : '10s', value : 10},
		    { label : '20s', value : 20},
		    { label : '30s', value : 30},
		    { label : '40s', value : 40},
		    { label : '50s', value : 50}
		    ]
		    },
	    data : [
		    {label : 'Gray Series', values : $attribute{gryvalues} },
		    {label : 'Pink Series', values : $attribute{pnkvalues} },
		    {label : 'Blue Series', values : $attribute{bluvalues} },
		    {label : 'Red Series',  values : $attribute{redvalues} }
		    ]
		    }"/&gt;
	&lt;/sun:markup&gt;
	&lt;/sun:form&gt;
	&lt;/sun:markup&gt;
	&lt;/sun:html&gt;
	 &lt;/sun:page&gt;
&lt;/define&gt;
&lt;/composition&gt;
		</pre>
	    </div>
    <div class="figure">Figure 3-3: TBD</div>
</a>

    <p>	If you are using NetBeans, follow these steps to create "<code>chart3.jsf</code>":</p>
    <ol class="j1hollist">
	<li>Select <b>Other Sources --&gt; resources</b>.</li>
	<li>Create an empty file named "<code>chart3.jsf</code>".</li>
	<li>Add the code defined in <a href="#chart3">Figure TBD</a> to "<code>chart3.jsf</code>".
	    <p><img src="images/ex3-editChart3.jpg"></p>
	    <div class="figure">Figure 3-4: Create Chart3.jsf</div>
	</li>
    </ol>
</a></li>

<div class="j1holwarn" style="text-align: center">Congratulations!  You've completed creating a JSF page that shows the jMaki chart in a template!</div>

<p><a href="#ex3contents">Back to step overview</a></p>

<hr style="WIDTH:100%; HEIGHT:2px"><br>

<a name="ex3stepB">
    <p><b>B. Modify Your console-config.xml.</b></p>
</a>
<p> You now need to add an <code>IntegrationPoint</code> to pluggin your
    Exercise 3 tree node into the Administration Console.  Just as in the
    previous exercise, you need to edit the <code>console-config.xml</code>
    file to add an <code>IntegrationPoint</code>.

<a name="ex3IP">
<div class="codebox">
<pre>
&lt;integration-point
	 id="Third"
	 type="tree"
	 priority="300"
	 parentId="j1root"
	 content="treenode-ex3.jsf" /&gt;
</pre>
</div>
<div class="figure">Figure 3-5: TBD</div>
</a>
</p>

<p> To complete this step outside NetBeans, add the <a href="#ex3IP">above
    code</a> specifying the <code>IntegrationPoint</code> to your
    <code>console-config.xml</code> file.  After completing this, you may
    proceed to <a href="#ex3stepC">Step C</a>.</p>

Step-by-step instructions in NetBeans:
<ol class="j1hollist">
    <li>Double-click on "<b>console-config.xml</b>" under <b>Other Sources
	    --&gt; resources --&gt; META-INF --&gt; admingui</b></li>

    <li>Edit the file and add the following <code>IntegrationPoint</code> (refer to <a href="#Solution_3">Solution 3 </a> for the entire file):


	<p><img src="images/ex3-editConfig.jpg" /></p>
	<div class="figure">Figure 3-6: Modify console-config.xml</div>
    </li>
</ol>
<p><a href="#ex3contents">Back to step overview</a></p>

<hr style="WIDTH:100%; HEIGHT:2px"><br>

<a name="ex3stepC">
    <p><b>C. Specify Your Tree Node Layout.</b></p>
</a>
<p> Next create a new file "<code>exercise-3.jsf</code>", which is specfied as
    the "content" of the <code>IntegrationPoint</code> you just created.

<div class="codebox">
<pre>
&lt;sun:treeNode
	id="third"
	text="Exercise #3"
	url="javaone/chart3.jsf"
	imageURL="resource/images/instance.gif"
	target="main"
/&gt;
</pre>
</div>
<div class="figure">Figure 3-7: TBD</div>

    <ol class="j1hollist">
	<li>Select <b>Other Sources --&gt; resources</b>.</li>
	<li>Create an empty file named <code>treenode-ex3.jsf</code> under <b>resources</b>.</li>
	<li>Edit "<code>treenode-ex3.jsf</code>" to specify the information regarding this second tree node.  
	    <p><img src="images/ex3-editTreenode.jpg"></p>
	    <div class="figure">Figure 3-8: Edit of treenode-ex3.jsf</div>
	</li>
    </ol>

    <p><a href="#ex3contents">Back to step overview</a></p>

    <hr style="WIDTH:100%; HEIGHT:2px"><br>
    <a name="ex3stepD">
	<p><b>D. Build and Install Your GlassFish v3 Plugin.</b></p>
    </a>
    <p>The last step of this implementation is to build the project on your system.  You can build the project by typing the following
    command:</p>
<div class="console">
<pre>
cd gfplugin/plugin
mvn install
</pre>
</div>

    <p> NetBeans have the option of building from within NetBeans by following these steps:</p>

    <ol class="j1hollist">
	<li>Right-click on the project "<code><b>Java One 2008 Administration Console Plugin</b></code>".</li>
	<li>Select <b>Build</b>.</li>
    </ol>
    <br>
    <p> You should now have a jar file named
	<code>gfplugin/myplugin/target/console-myplugin-1.0-SNAPSHOT.jar</code>.
	This jar file is ready to install into GlassFish v3!</span></p>

<p> You now need a Terminal to enter some commands, please bring up a terminal window.
For your convenience, GlassFish v3 has been installed as <code>gfplugin/glassfish</code>.
The following steps show you how to integrate and test your plugin module.<br>


<p><b>Step-by-step instruction:</b></p>
<ol class="j1hollist">
    <li>Go to your <code>gfplugin</code> directory.
<div class="console">
<pre>
cd gfplugin
</pre>
</div>
    </li>
    <li>Shut down the server which may be started from a previous exercise:<br>
<div class="console">
<pre>
glassfish/bin/stop-domain
</pre>
</div>
    </li>
    <li>Integrate the jar into GlassFish by simply copying it to the GlassFish modules directory.
<div class="console">
<pre>
cp myplugin/target/console-myplugin-1.0-SNAPSHOT.jar glassfish/modules/console-myplugin-1.0-SNAPSHOT.jar
</pre>
</div>
    </li>
    <li>Start the server again:
<div class="console">
<pre>
glassfish/bin/asadmin start-domain
</pre>
</div>
    </li>
    <li>In the browser enter the following URL to bring up the
	Administration Console.<br>
	<div class="codebox"><pre>http://localhost:8080/admingui/index.jsf</pre></div>

	<p> Expand the <code>JavaOne</code> tree node which is displayed in
	    the navigation tree.  Note the new tree node "Exercise #3" under
	    it.  Click on the "Exercise #3" tree node which displays the charts
	    and notice that there is a header added to the charting page.</p>
	<p> <img src="images/ex3-result.jpg"></p>
	<div class="figure">Figure 3-9: Browser showing the plugin page with charts.</div>
    </li>
</ol>
<div class="j1holwarn" style="text-align: center">Congratulations!  You have customized the Administration Console and
    plugged in your own tree node to show the jMaki Charts with a customized header.
    <br>
    Try to change the dropdown box to select another charting style
</div>

<hr style="WIDTH:100%; HEIGHT:2px"><br>

<p class="j1holheader">Summary:</p>

<p>In this exercise, you have created a JavaServlet Page with jMaki Charting, the chart is customized by using a templat.  You added the plugin module with the additional tree node to the Administration Console.</p>

<p><a href="#Solution_3">Go to Exercies 3 Solution</a></p>
<p><a href="#Exercise_2">Go to Exercise 2</a></p>
<p><a href="#Summary">Go on to the summary of this Lab</a></p>
</div>
</body>
</html>
