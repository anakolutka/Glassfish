<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:sc="http://java.sun.com/mojarra/scales"
      xmlns:sun="http://www.sun.com/webui/webuijsf"
      xmlns:jsfExt="http://java.sun.com/jsf/extensions/dynafaces">

<!-- initPage must exist outside all UIComponents (for now) -->
<ui:event type="initPage">
    setResourceBundle(key="i18n" bundle="org.glassfish.admingui.core.Strings");
    setResourceBundle(key="help" bundle="org.glassfish.admingui.core.Helplinks");
    getAmxRoot(amxRoot="#{requestScope.amxRoot}");
    setAttribute(key="anonLogin", value="#{amxRoot.realmsMgr.anonymousLogin}");
</ui:event>

<!-- Composition for trimming -->
<ui:composition>
<sun:page>
<sun:html>
    <ui:event type="beforeCreate">
        checkSupport(supportCluster=>$session{supportCluster});
        if( $session{supportCluster}){
            initClusterSessionAttribute();
            setSessionAttribute(key="notSupportCluster" value="$boolean{false}");
        }
        if(! $session{supportCluster}){
            setSessionAttribute(key="notSupportCluster" value="$boolean{true}");
        }

        showRegistration(value=>$session{showRegistration});
        if ($session{showRegistration}){
            setRegistrationNodeText();
        }

        if(! $session{supportCluster}){
            checkRestart(RestartRequired=>$session{restartRequired},
            unprocessedChanges=>$session{unprocessedChanges});
        }
        if($session{supportCluster}){
            setSessionAttribute(key="restartRequired" value="$boolean{false}");
        }

	// Set expand / collapse preferences...
	if ("#{sessionScope.hideLeft}=#{null}") {
	    getPreference(default="#{false}", root="glassfish/layout", key="hideLeft", value="#{sessionScope.hideLeft}");
	}
	if ("#{sessionScope.hideRight}=#{null}") {
	    getPreference(default="#{false}", root="glassfish/layout", key="hideRight", value="#{sessionScope.hideRight}");
	}
    </ui:event>
    <sun:head title="#{guiTitle}" debug="true" parseOnLoad="false">
        <link rel="stylesheet" type="text/css" href="#{request.contextPath}/style.css" />
        <sc:links/>
        <sun:script url="/resource/js/adminjsf.js" />
        <jsfExt:scripts/>
	<ui:insert name="guiTemplateExtraHead" />
	<ui:insert name="guiExtraHead" />
	<style type="text/css">
	    .yui-skin-sam .yui-layout .yui-layout-unit-center div.yui-layout-bd {background-color: #FFF;}
	    .yui-layout-hd h2 {background: #7595AB url(#{request.contextPath}/theme/woodstock4_3/suntheme/images/masthead/masthead_button.gif) repeat-x scroll center bottom;}
	    .tagDiv {padding: 10px;}
	    .tagDiv .tagList {padding: 10px;}
	    .tagDiv .tagList li {padding: 3px;}
	    .tagDiv .tagList a.tagLink:visited, .tagDiv .tagList a.tagLink:link, .tagDiv .tagList a.removeTag:visited, .tagDiv .tagList a.removeTag:link {color: #000099}
	    .tagDiv .tagList a.tagLink:hover {color: #0000CC}
	    .tagDiv .tagList a.removeTag {margin-left: 6px;padding: 1px 2px 1px 2px; text-decoration:none; background:#EEEEEE;border:1px solid #AAA;}
	    .tagDiv .tagList a.removeTag:hover {color:red; font-weight:bold; text-decoration:none;}
	</style>
    </sun:head>

    <sun:body onLoad="#{guiOnLoad}#{guiTemplateOnLoad}">
<sc:layout id="gfLayout" fullPage="true">
    <sc:layoutUnit id="gfLayoutTop" position="top" height="110" scroll="false" gutter="5px" resize="false" collapse="false">
        <div class="header_main">
            <sun:form id="headerForm">
		<h:commandButton id="setPref" style="display: none;">
		    <ui:event type="afterCreate">
			setPageSessionAttribute(key="setPrefId" value="$this{clientId}");
		    </ui:event>
		    <ui:event type="command">
			// FIXME: may want to escape param values here
			setPreference(root="glassfish/#{param.root}", key="#{param.key}", value="#{param.value}");
			if ("#{param.sessionKey}") {
			    setSessionAttribute(key="#{param.sessionKey}", value="#{param.value}");
			}
		    </ui:event>
		</h:commandButton>
                <!-- Customizing the masthead -->
                <ui:event type="afterCreate">
                    getClientId(component="$this{component}" clientId=>$attribute{formId})
                    getUIComponent(clientId="#{formId}"  component=>$attribute{component})
                    includeFirstIntegrationPoint(type="org.glassfish.admingui:masthead" root="#{component}");
                </ui:event>
            </sun:form>
        </div>
    </sc:layoutUnit>

    <sc:layoutUnit id="gfLayoutLeft" position="left" width="250" gutter="5px" resize="true" header="Tree" collapse="true">
        <ui:insert name="guiLeftNav" />
    </sc:layoutUnit>

    <sc:layoutUnit id="gfLayoutCenter" position="center" scroll="true" gutter="5px">
	<ui:insert name="guiTopNav" />
	<!-- Content -->
	<div id="content" style="padding-left: 5px; padding-right: 5px;">
	    <h:messages />
	    <ui:insert name="guiTemplateContent">
		<ui:insert name="content">
		    Content Missing!
		</ui:insert>
	    </ui:insert>
	</div>


    </sc:layoutUnit>
    <!--

      I am commenting out the tags panel for now... this functionality should go back into the UI at some point...
	//<ui:include src="/tagsPanel.jsf" />
    -->

    <sc:layoutUnit rendered="#{pageSession.rightContent[0] != null}" id="gfLayoutRight" position="right" width="250" gutter="5px" resize="true" header="#{pageSession.rightContent[0].content}" collapse="true">
	<event>
	    <ui:event type="afterCreate">
		// FIXME: Consider using a widget which allows multiple content types to share the right panel (i.e. accordian)
		includeFirstIntegrationPoint(type="org.glassfish.admingui:rightPanel" root="$this{component}");
		getIntegrationPoints(type="org.glassfish.admingui:rightPanelTitle" points="#{pageSession.rightContent}");
	    </ui:event>
	</event>
    </sc:layoutUnit>
</sc:layout>
<!--
	Add Tag Panel
        <sc:panel id="addTagPanel" visible="false" modal="true" closable="true" fixedCenter="true">
            <h3>Tag the Current Page</h3>
            <sun:form id="tagForm">
                <div style="padding: 10px;">Tag: <h:inputText id="tag" value="#{requestScope.tag}"/></div>
                <h:inputHidden id="url" value="#{requestScope.url}"/>
                <h:commandButton id="addTagButton" value="Add Tag" onclick="submitTagForm(this); return false;">
                    <ui:event type="command">
			setAttribute(key="tagName" value="FIXME: Get Page Name");
                        //saveTagInformation(tag="$attribute{tag}", name="$attribute{tagName}", url="#{requestScope.url}");
                        setAttribute(key="tag" value="");
                        setAttribute(key="tagName" value="");
                    </ui:event>
                </h:commandButton>
            </sun:form>
        </sc:panel>
-->

	<!--
	Search Tags Panel
        <sc:panel id="searchTagsPanel" visible="false" modal="true" closable="true" fixedCenter="true" width="300px">
            <h3>Search Tags</h3>
                <div style="width:40px; float: left">Tag:</div>
                <sun:form id="tagSearch">
                    <h:inputText id="tag" value="#{requestScope.tag}"/>
                    <h:commandButton id="searchTagButton" value="Search" onclick="submitTagSearchForm(this); return false;">
                        <ui:event type="command">
                            //searchTags(tag="$attribute{tag}", hits=>$attribute{tagSearchHits});
                            setAttribute(key="tag" value="");
                        </ui:event>
                    </h:commandButton>
                </sun:form>
                <div style="height: 200px; overflow: auto;">
                    <h:dataTable id="hits" value="#{requestScope.tagSearchHits}" var="hit">
                        <h:column><a href="#{hit.url}">#{hit.name}</a></h:column>
                    </h:dataTable>
                </div>
        </sc:panel>
	-->
    </sun:body>
</sun:html>

<!-- FIXME: this should be in adminjsf.js -->
<script type="text/javascript">
    function submitTagForm(el) {
	YAHOO.util.Dom.get('tagForm:url').value = window.location;
	DynaFaces.fireAjaxTransaction(el,
	    {
		execute: 'tagForm:tag,tagForm:name,tagForm:url,'+el.id,
		inputs: 'tagForm:tag,tagForm:name,tagForm:url,'+el.id,
		render: 'tagForm:tag,tagForm:name,tagForm:url,'+el.id,
		postReplace: function() {
		    YAHOO.util.Dom.get('tagForm:tag').value = '';
		    YAHOO.util.Dom.get('tagForm:name').value = '';
		    hidePanel('addTagPanel');
		}
	    } );
    }
    function submitTagSearchForm(el) {
	DynaFaces.fireAjaxTransaction(el,
	    {
		execute: 'hits,tagSearch:tag,'+el.id,
		inputs: 'hits,tagSearch:tag,'+el.id,
		render: 'hits',
		postReplace: function(zone, html) {
		    YAHOO.util.Dom.get('tagSearch:tag').value = '';
		}
	    } );
    }

<!--
    FIXME: I think this would be better implemented using Y!'s KeyListener:
    http://developer.yahoo.com/yui/examples/container/keylistener.html
    function showSearchPanel(e) {
	var result = true;
	if ((e.charCode == 102) &amp;&amp; (e.ctrlKey == true)) {
	    showPanel('searchTagsPanel');
	    if (e.preventDefault) {
		e.preventDefault();
	    }
	    result = false;
	}
	return result;
    }
    YAHOO.util.Event.addListener(document, "keypress", showSearchPanel);
-->

    // Save the prefs button so it is accessible via our JS
    if (typeof(admingui) === "undefined") {
	admingui = {};
    }
    admingui.setPrefButton = document.getElementById("#{pageSession.setPrefId}");

    // Collapse panels if necessary
    YAHOO.util.Event.onDOMReady(function (ev) {
	var layout = getLayout('gfLayout');
	var lu = layout.getUnitByPosition('left');
	lu.on('collapse', function(ev) {
	    admingui.util.setPreference("layout", "hideLeft", "true", "hideLeft");
	});
	lu.on('expand', function(ev) {
	    admingui.util.setPreference("layout", "hideLeft", "false", "hideLeft");
	});
	if (#{sessionScope.hideLeft}) {
	    lu.collapse();
	}

	// Deal w/ the right frame
	lu = layout.getUnitByPosition('right');
	lu.on('collapse', function(ev) {
	    admingui.util.setPreference("layout", "hideRight", "true", "hideRight");
	});
	lu.on('expand', function(ev) {
	    admingui.util.setPreference("layout", "hideRight", "false", "hideRight");
	});
	if (#{sessionScope.hideRight}) {
	    lu.collapse();
	}
    });

</script>

</sun:page>
</ui:composition>
</html>
