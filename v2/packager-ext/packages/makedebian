COMPONENT=$1
BUILD_ID=$2
HOST_OBJ_DIR=$3
PACKAGER_PACKAGE_HOME=$4
GLASSFISH_ROOT=$5

if [ $# -ne 5 ]; then
   echo "Usage: makedebian <component> <buid_id> <top_dir> <build_root> <host_obj_dir> <debian_build_root> <packager_package_home> <glassfish_root>"
   exit 1
fi

ZIPFILEDIR=../../$PACKAGER_PACKAGE_HOME
TMPDIR=$ZIPFILEDIR/tmp
DEBIANDIR=$GLASSFISH_ROOT/publish/packages/$HOST_OBJ_DIR/debian
COMPONENT_LOWERCASE=`echo $COMPONENT | tr '[A-Z]' '[a-z]'`
VERSION=9.0.01
DUMMYSTDIN=dummystdin
COPYNEEDEDFILES=copyneededfiles.sh
COMPONENT_DIR=$COMPONENT_LOWERCASE-$VERSION
DEBIANPACKAGE=${COMPONENT_LOWERCASE}_${VERSION}_i386.deb
echo "DEBIANPACKAGE = $DEBIANPACKAGE"
DSCPACKAGE=${COMPONENT_LOWERCASE}_${VERSION}.dsc
echo "DSCPACKAGE = $DSCPACKAGE"

echo "Building debian of package $COMPONENT $BUILD_ID/"
echo "Verify that $TMPDIR exists"
# create temp directory 
echo "PWD=$PWD"
if [ ! -d $TMPDIR ]; then
   echo "mkdir -p $TMPDIR"
   mkdir -p $TMPDIR
fi
echo "Verify that $TMPDIR/$COMPONENT_DIR exists"
# create component specific directory
if [ ! -d $TMPDIR/$COMPONENT_DIR ]; then
   echo "mkdir -p $TMPDIR/$COMPONENT_DIR"
   mkdir -p $TMPDIR/$COMPONENT_DIR
fi
echo "Verify that $TMPDIR/$DUMMYSTDIN exists"
if [ ! -f $TMPDIR/$DUMMYSTDIN ]; then
   echo "cp -f ../$DUMMYSTDIN $TMPDIR/$DUMMYSTDIN"
   cp -f ../$DUMMYSTDIN $TMPDIR/$DUMMYSTDIN
fi
echo "Verify that $TMPDIR/$COPYNEEDEDFILES exists"
if [ ! -f $TMPDIR/$COPYNEEDEDFILES ]; then
   echo "cp -f ../$COPYNEEDEDFILES $TMPDIR/$COPYNEEDEDFILES"
   cp -f ../$COPYNEEDEDFILES $TMPDIR/$COPYNEEDEDFILES
fi
echo "Verify that $ZIPFILEDIR/$COMPONENT.zip has been copied to $TMPDIR/$COMPONENT_DIR"
# copy zip file to component specific directory in temp directory
if [ -f $ZIPFILEDIR/$COMPONENT.zip ]; then
   echo "unzip -u $ZIPFILEDIR/$COMPONENT.zip -d $TMPDIR/$COMPONENT_DIR"
   unzip -u $ZIPFILEDIR/$COMPONENT.zip -d $TMPDIR/$COMPONENT_DIR
fi
echo "cp -f ./Makefile.default $TMPDIR/$COMPONENT_DIR/Makefile"
cp -f ../Makefile.default $TMPDIR/$COMPONENT_DIR/Makefile
echo "make -C $TMPDIR/$COMPONENT_DIR dhmake" 
make -C $TMPDIR/$COMPONENT_DIR dhmake 
echo "verifying $DEBIANDIR"
if [ ! -d $DEBIANDIR ]; then
   echo "mkdir -p $DEBIANDIR"
   mkdir -p $DEBIANDIR
fi
echo "cp -f $TMPDIR/$DEBIANPACKAGE $DEBIANDIR"
cp -f $TMPDIR/$DEBIANPACKAGE $DEBIANDIR
echo "cp -f $TMPDIR/$DSCPACKAGE $DEBIANDIR"
cp -f $TMPDIR/$DSCPACKAGE $DEBIANDIR
echo "Debian Packages copied!"
