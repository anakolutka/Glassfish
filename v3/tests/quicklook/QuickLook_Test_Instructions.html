<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <meta http-equiv="CONTENT-TYPE"
 content="text/html; charset=windows-1252">
  <title>QuickLook Instructions</title>
  <meta name="GENERATOR" content="StarOffice 8  (Win32)">
  <meta name="AUTHOR" content="d s">
  <meta name="CREATED" content="20080319;10465059">
  <meta name="CHANGED" content="20080325;17282512">
  <style>
	<!--
		@page { size: 8.5in 11in; margin: 0.79in }
		P { margin-bottom: 0.08in }
.red {
	color: #F00;
}
	-->
	</style>
</head>
<body dir="ltr" lang="en-US">
<h1 style="margin-left: 80px;"><big><font style="font-size: 16pt;"
 size="4"><big><b><font face="Trebuchet MS, sans-serif">Instructions
for QuickLook tests</font></b></big></font></big></h1>
<br>
<p style="margin-bottom: 0in;" align="left"><big><font size="4"><big><b>I.
Running QuickLook tests:</b></big></font></big></p>
<br>
Install/unzip the glassfish bundle to a directory. Let's call the full
path to glassfish directory as {V3 Installation Dir}. Please do not
install glassfish under v3/tests/quicklook since the "clean" target of
QuickLook will clean up all war files under quicklook directory. Change
directory to v3/tests/quicklook. All italic text indicate a
command. <br>
<br>
<span style="font-weight: bold;">1. To Run All Web Bundle Tests from
Top Level:</span><br>
<ul>
  <li>For <span style="font-weight: bold;">web.zip</span> bundle of
V3: <br>
  </li>
  <ul style="font-style: italic;">
    <li>mvn -Dglassfish.home={V3 Installation Dir} test | tee run.log</li>
  </ul>
  <li>For <span style="font-weight: bold;">web-ips.zip</span> bundle
of V3, the javadb is at the same level of glassfish and property <i
 style="font-style: italic;">derby.system.home </i>need to be set: <br>
  </li>
  <ul>
    <li><i style="font-style: italic;">mvn -Dglassfish.home=</i><span
 style="font-style: italic;">{V3 Installation Dir}/glassfish</span><i
 style="font-style: italic;">
-Dderby.system.home=</i><span style="font-style: italic;">{V3
Installation Dir}</span><i>/javadb&nbsp; test</i></li>
  </ul>
</ul>
<i><span style="font-style: italic;"></span></i>The test results will
be in test-output-felix directory.<br>
<br>
<span style="font-weight: bold;">2. To Run Individual Test Suite from
Directory Level:</span><br>
<br>
After the first run with maven from top level, the dependency jars will
be downloaded to local maven repository. Now it's possible to run
individual test suite from directory level. Change directory to the
test directory. For example, to run quicklook/web/helloworld test suite
for <span style="font-weight: bold;">web.zip</span> bundle:<br>
<ul>
  <ul>
    <li><i>ant -Dglassfish.home=</i><span style="font-style: italic;">{V3
Installation Dir}</span><i>&nbsp; startDerby</i></li>
    <li><i>ant -Dglassfish.home=</i><span style="font-style: italic;">{V3
Installation Dir}</span><i>&nbsp; start-server-felix</i></li>
    <li style="font-style: italic;">cd web/helloworld</li>
    <li><span style="font-style: italic;">ant -Dglassfish.home={V3
Installation Dir} all</span><br>
    </li>
  </ul>
</ul>
For <span style="font-weight: bold;">web-ips.zip</span> bundle,
property <i style="font-style: italic;">derby.system.home </i>need to
be set as shown in section 1.<br>
<br>
<span style="font-weight: bold;">3. To Run JRuby Tests</span><span
 style="font-weight: bold;">:</span><br>
<ul>
  <li>From top leve v3/tests/quicklook dir:</li>
  <ul style="font-style: italic;">
    <li>mvn -f web/jruby/pom.xml -Dglassfish.home={V3 Installation Dir}
test | tee run.log</li>
  </ul>
  <li>Or from v3/tests/quicklook/web/jruby dir:</li>
  <ul style="font-style: italic;">
    <li>mvn -Dglassfish.home={V3 Installation Dir} test | tee run.log</li>
  </ul>
</ul>
For the first time of running JRuby tests, the JRuby/Rails env will be
setup so this will take a littie time (one minute on my machine). The
JRuby setup will be done in local maven reprository and this step will
be skipped if the local maven repro is used.&nbsp; The test results
will be in test-output-jruby directory.<br>
<br>
<span style="font-weight: bold;">4. Using Local Maven Repository in
Non-Default Directory:</span><br>
Section 1 and 2 assume the use of default local maven repository
directory, ${user.home}/.m2/repository. If you local maven repository
is in another directory, say directory {Local_Maven}, you can use one
of the following ways to point to your specific maven repository:<br>
<ul>
  <ul>
    <li>Add option on command line: <span style="font-style: italic;">-Dmaven.repo.local={Local_Maven}</span></li>
    <li>Set MVN_OPTS environment varialable: <span
 style="font-style: italic;">MVN_OPTS="-D-Xmx512M
-Dmaven.repo.local={Local_Maven}"</span></li>
    <li>Make a symbolic link from&nbsp;${user.home}/.m2/repository to
the actuall maven repository.</li>
    <li>Another option is to use ${user.home}/.m2/settings.xml which
points to the repository location<br>
      <div style="margin-left: 40px; font-style: italic;">&lt;settings&gt;
      <br>
&lt;localRepository&gt;<span class="moz-txt-slash"><span
 class="moz-txt-tag">/</span>abc<span class="moz-txt-tag">/</span></span>.m2/repository&lt;/localRepository&gt;
      <br>
&lt;/settings&gt; <br>
      </div>
    </li>
  </ul>
</ul>
The finial report will be available under directory
quicklook/test-output-felix.<br>
<p style="margin-bottom: 0in;"><big><big style="font-weight: bold;">II.
Adding Tests to QuickLook</big></big><br>
</p>
<p style="margin-bottom: 0in;">The test framework of QuickLook is <a
 href="http://testng.org/doc/">TestNG</a>. TestNG allows us to
add/remove tests from harness easily and simplifies the client side
programming. Below is an example of how to add a test suite to QL:<br>
</p>
<p style="margin-bottom: 0in;">An easy way to do is to copy an existing
test suite, such as quicklook/web/helloworld, to your test directory.
Then add your java or xml files (or your logic to the existing files)
to the test directory. The build.xml and properties files are
inherited. <br>
<br>
For examples on the client side java code, please look at the following
files for reference <br>
quicklook/web/helloworld/src/test/HelloJSPTestNG.java<br>
quicklook/web/jsfastrologer/src/test/JSFWebTestNG.java<br>
<br>
Here is an example of adding a test suite hellouniverse. All italic
text indicate a command. Unix OS is used for the commands<br>
<br>
<span style="font-style: italic;">% cp -r helloworld hellouniverse</span><br>
<span style="font-style: italic;">% cd hellouniverse</span><br>
<br>
Please make the following changes to build.properties<br>
&nbsp;<br>
war.file=hellouniverse<br>
testsuite.name=basicweb<br>
testng.test.name=web_jsp_hello_universe<br>
contextroot=hellouniverse<br>
deploy.platform=v3<br>
<br>
Please make&nbsp; following changes to build.xml.&nbsp; Change Project
name<br>
&lt;project name="hello-universe" default="default" basedir="."&gt;<br>
Under runtest target<br>
&lt;param name="contextroot" value="hellouniverse"/&gt;<br>
<br>
<span style="font-style: italic;">% cd metadata</span><br>
<br>
Edit web.xml to reflect the new application as universe .<br>
<br>
Edit src/java/SimpleServlet.java, change the name of servlet to
SimpleServlet1, change the package directory from myapp to
hellouniverse and rename to src/java/SimpleServlet1.java<br>
<br>
Edit src/test/HelloJSPTestNG.java, change the classname, testurl&nbsp;
and rename to src/test/HelloUniverseTestNG.java<br>
<br>
Now all editing is complete, lets try to build/deploy/run from leaf
level (hellouniverse level)<br>
<br>
Assume we are using web.zip for glassfish. Make sure javadb and server
are started&nbsp; (please use ant 1.6.5)<br>
<span style="font-style: italic;">% cd v3/test/quicklook</span><br
 style="font-style: italic;">
<span style="font-style: italic;">% ant -Dglassfish.home={V3
Installation Dir} startDerby</span><br>
<span style="font-style: italic;">% ant </span><span
 style="font-style: italic;">-Dglassfish.home={V3 Installation Dir} </span><span
 style="font-style: italic;">start-server</span><br>
<br>
Once the server and derby are started, go to <br>
<span style="font-style: italic;">% cd web/hellouniverse</span><br>
<span style="font-style: italic;">% ant&nbsp; -Dglassfish.home={V3
Installation Dir} build </span><br>
<br>
Make sure no errorss on consol<br>
<span style="font-style: italic;">% ant&nbsp; -Dglassfish.home={V3
Installation Dir} deploy </span><br>
<br>
make sure no errors in server.log (while loading application)<br>
<span style="font-style: italic;">% ant&nbsp; -Dglassfish.home={V3
Installation Dir}&nbsp; runtest</span><br>
</p>
<p style="margin-bottom: 0in;">Now you should see 4 tests run and
passed <br>
Please add "all" target to include "build deploy runtest"<br>
</p>
<p style="margin-bottom: 0in;">To integrate your tests into quicklook,
please contact <a href="ming.zhang@sun.com">Ming Zhang</a> .<br>
</p>
<p style="margin-bottom: 0in;"><big><big><span
 style="font-weight: bold;">III. Reference:</span></big></big><br>
</p>
<p style="margin-bottom: 0in;"><a
 href="http://appserver.sfbay.sun.com/attach/GlassFishV3Internal%2FHowToAddTests.odt">Add
tests to QuickLook.</a><br>
</p>
<p style="margin-bottom: 0in;"><span style="font-weight: bold;"><br>
</span></p>
<p style="margin-bottom: 0in;"></p>
</body>
</html>
