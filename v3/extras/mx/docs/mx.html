<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>The 'mx' User Guide</title>
<meta http-equiv="Content-Type"
 content="text/html; charset=UTF-8" />
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.5.2/build/reset-fonts-grids/reset-fonts-grids.css" />
<link href="../../styles2.css" rel="stylesheet" type="text/css" />
<link href="../../misc.css" rel="stylesheet" type="text/css" />
<style type="text/css">
<!--

/* Primary block-level tag characteristics */

body {
	font-family: Trebuchet, Arial, sans-serif;
	font-size: 90%;
	line-height: 140%;
}

p {
	margin-bottom: 0.5em;
}

h1 {
	font-size: 153.9%;
	margin: 2em 0 1em 0;
	font-weight: bold;
	line-height: 120%;
}

h2 {
	font-size: 123.1%;
	margin: 2em 0 1em 0;
	font-weight: bold;
	line-height: 120%;	
}

h3 {
	font-weight: bold;
	margin: 2em 0 0.5em 0;
	line-height: 120%;	
}

h3 {
	font-weight: bold;
	margin: 2em 0 0.5em 0;
	line-height: 120%;	
}

ol {
	margin-left: 2em;
}

ol li {
	margin-bottom: 0.5em;
	list-style-type: decimal;
}

ul {
	margin-left:  1.5em;
}

ul li {
	margin-bottom: 0.5em;
	list-style-type: square;
}

dt {
	margin-left: 2em;
	font-weight: bold;
}

dd {
	margin-left: 2em;
	margin-bottom: 1em;
}


/* Primary in-line tag characteristics */

a {
	text-decoration: none;
	color: #264277;
}

a:hover {
	color: red;
	text-decoration: underline;
}

strong {
	font-weight: bold;
}

em {
	font-style: italic;
}

/* disable visual characteristics of hyperlinked headings */

h1 a, h2 a, h3 a {
	color: black;
}

h1 a:hover, h2 a:hover, h3 a:hover {
	color: #264277;
	text-decoration: none;
}

/* standardized page header/footer */

div#hd div.title {
	font-family: Georgia;
	font-size: 153.9%;
	text-align: center;
	clear: both;
	font-weight: bold;
}

div#hd div.subtitle {
	font-family: Georgia;
	font-size: 100%;
	text-align: center;
	line-height: 120%;
	font-style: italic;
	color: #78a2cc;
}

div#hd div.byline {
	font-family: Georgia;
	font-size: 88%;
	text-align: center;
	margin-top: 0.2em;
	line-height: 120%;
	font-style: italic;
}

div#ft {
	font-family: Georgia;
	text-align: center;
}

div#globalnav {
	background-color: #78a2cc;
	font-family: Helvetica, Arial, sans;
}

div#globalnav li {
	font-size: 88%;
	border-right: 2px dashed gray;
}


/* Standardized style */

div.photo div.caption {
	font-style: italic;
}

div.info {
	background-color: #dbebfe;
	border: 2px solid #7b8490;
}

div.warning {
	background-color: #f6bbb2;
	border: 2px solid red;
}

img.stroke1 {
	border: 1px solid #000;
}

img.stroke2 {
	border: 1px solid #000;
}

table caption {
	text-align: center;
	font-size: 123.1%;
	font-weight: bold;
}

th {
	font-weight: bold;
}

a.permalink {
	color: lightgray;
	border: 1px solid lightgray;
	letter-spacing: .3em;
	font: 9px "Helvetica Neue", Helvetica, Arial, Geneva, sans-serif;
	display: inline-block;
	padding: 1px 2px 1px 3px;
	margin-left: 1em;
	vertical-align: 3px;
}

a:hover.permalink {
	color: red;
	background-color: lightgray;
	border: 1px solid gray;
}











/* Page heading layout for article pages */

div#siteheader {
	padding: 1em 0 1em 0;
	border-bottom: 2px solid lightgray;
	cursor: pointer;	
}

div#articlenav {
	margin: 0;
	line-height: 18px;
}

div#articleTitle {
	margin-top: 1.3em;
	float: left;
	color: lightgray;
	font-size: 88%;
	font-weight: bold;
	font-style: italic;
}

select#TOCSelect {
	margin-top: 1em;
	float: right;
}

/* Gross layout for article pages */

div#bd {
	margin: 1em 5em 1em 5em;
}

div.columnheadings {
	margin-bottom: 1em;
}


div.bottomnav {
	text-align: right;
}

div.nextpage {
	font-weight: bold;
}

div.prevpage {
	font-size: 88%;
}











/* standard gross white space management */

div#ft {
	border-top: 1px solid lightgray;
	padding: 1em 0 1em 0;
}

/* General layout */

.left {
	float: left;
}

.right {
	float: right;
}

div.photo {
	text-align: center;
	margin: 1em 3em 1em 3em;
}


div.callout {
	margin: 1em 4em 1em 4em;
	padding: 0.8em 1em 0.8em 1em;
	-webkit-border-radius: 0.75em;	
}


table {
	margin-top: 1em;
	margin-left: auto;
	margin-right: auto;	
	margin-bottom: 1em;
	font-size: 85%;
}

table caption {
	margin-bottom: 0.5em;
}

thead {
	border-bottom: 1px solid black;
}

th {
	padding-left: 0.5em;
	padding-right: 0.5em;
	background-color:  #F8F8F8;
	border: 1px solid #AAA;
}

td {
	border: 1px solid #CCC;
	padding-left: 0.5em;
	padding-right: 0.5em;
}

div#globalnav {
	height: 1.9em;
}

div#globalnav ul {
	margin-left: 0;
	display: inline;
}

div#globalnav li {
	float: left;
	list-style-type: none;
	display: inline;
	height: 1.9em;
	line-height: 2em;
	padding: 0em 1em 0em 1em;
}

.pseudobutton {
	cursor: pointer;
}

div#globalnav li img {
	margin-top: 0.3em;
	line-height: 30px;
}









div#table-of-contents {
	font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
	position: relative;
	space-before: 0px;
	padding: 2px;
	
	margin-top: 0px;
	margin-left: 20px;
	margin-right: 20px;
	
	border-top: 1px solid gray;
	border-bottom: 1px solid gray;
}

div#table-of-contents p {
	font-size: 75%;
	margin-top: 4px;
	margin-bottom: 4px;
	line-height: 125%;
}

.center {
	text-align:  center;
}

table.table-hover tr:hover {
 background-color: #EEE;
}

.action {
	font-size: 12px;
	border: 1px solid black;
	background-color:#FFFFC0;
	padding-top: 6px;
	padding-left: 4px;
	padding-right: 4px;
	padding-bottom: 6px;
}

.warning {
	font-size: 12px;
	border: 1px solid black;
	background-color:#FFF0F0;
	padding-top: 6px;
	padding-left: 4px;
	padding-right: 4px;
	padding-bottom: 6px;
}

.warning
{
	font-family: "Comic Sans MS", "Trebuchet MS", Arial, Helvetica, sans-serif;
	font-weight: normal;
	font-size: 14px;
	line-height: 140%;
	padding: 6px;
	background-color: #FF8080;
	border: 1px solid black;
}

.warning:hover
{
	background-color: #FFD0D0;
}


.tbd {
	font-family: "Monaco", "Courier", "Courier New", mono;
	font-size: 9px;
	border: 1px solid gray;
	background-color: #FFFFAA;
	padding: 1px;
}



.single-image {
	text-align: center;
	font-size: 12px;
	font-family: Arial, Helvetica, sans-serif;
	color: #444;
	font-weight: bold;
}



.menu-item {
	font-family: "Lucida Grande", Arial, Helvetica, sans-serif;
	font-size: 14px;
	font-weight: bold;
}



.text-red {
	color: #c00;
}

.text-dark-red {
	color: #600;
}


.code-block {
	font-family: "Courier", "Courier New", mono;
	padding-left: 1.0em;
	line-height: 110%;
	
	margin-top:  1.0em;
	margin-bottom:  1.0em;
	
	color: #555;
}

.code {
	font-family: "Courier", "Courier New", mono;
	color: #040;
}

.sub-cmd {
	font-weight: bold;
	color:  black;
}

.operand {
	color: black;
}

.option {
	color: #060;
}
.meta-option {
	color: #848;
}

.path {
	color: #448;
}
.attribute {
	color: #448;
}


a.permalink {
	color: lightgray;
	border: 1px solid lightgray;
	letter-spacing: .3em;
	font: 9px "Helvetica Neue", Helvetica, Arial, Geneva, sans-serif;
	display: inline-block;
	padding: 1px 2px 1px 3px;
	margin-left: 1em;
	vertical-align: 3px;
}

.issue {
	border: 1px solid gray;
	background-color: #FCC;
	margin-left: 20px;
	margin-right: 20px;
	padding: 2px;
}

-->
</style>
</head>
<body id="doc" >
<div id="hd">
  <div id="siteheader">
    <div class="title">The 'mx' User Guide</div>
    <div class="subtitle"><span class="text-red">DRAFT</span></div>
    <div class="byline">by Lloyd Chambers</div>
    <div class="byline">v 0.91 , January 8, 2010, <a href="#RevisionHistory">revision history</a></div>
  </div>
</div>
<div id="bd">
  <h1><a name="Introduction" id="Introduction"></a>1. Introduction</h1>
  <p class="info">Send comments to: lloyd.chambers (at sun.com)  </p>
<p>Anyone working with AMX MBeans is strongly advised to try the mx command line, available as part of the GlassFish V3 source base.   It can aid greatly in understanding and accessing the MBeans.  </p>
<h3>Brief overview</h3>
  <p>The 'mx' command line is a “shell” for accessing JMX servers. 
    It makes easy what is  awkward in programs like JConsole.</p>
  <p>Using 'mx', you can:</p>
  <ul>
    <li>get and set attributes, singly or in bulk, and on one or more MBeans in a single command;</li>
    <li>invoke operations on one or more MBeans in a single command;</li>
    <li>generate a Java interface for an MBean or MBeans;</li>
    <li>find MBeans, including wildcarding;</li>
    <li>a lot more. </li>
  </ul>
  <h3>Limitations</h3>
  <p>The 'mx' command was formerly known as 'mx'. The code base is actually over six years old. While relatively aged, it has proven its worth over years of development, being used as a tool each and every day for appserver MBean development.</p>
  <p>The primary limitation of mx is parsing: a scriptable and well-defined grammar and parser would make it even more useful.</p>
  <p>Another limitation at present is that certain commands are implemented using support of the GlassFish V3 server (eg the 'cd', 'ls', etc commands). This support should be moved into the client at some point, so it can work against any implementation.</p>
  <h3>Building</h3>
  <p>To build mx, you’ll need to check out the GlassFish V3 source base and build it, or at least make sure the appropriate jar files are in place. See <span class="code">extras/mx/README_BUILD.txt</span>.</p>
  <pre class="code">cd glassfish
mvn install
cd extras/mx
./mk.sh</pre>
  <h1>2. Quick start</h1>
  <p>For these examples, we will connect to a GlassFish V3 server, because it allows us to demonstrate specific functionality with known results.</p>
  <p>Comments are preceded with a hash '#' mark below. Output is omitted or truncated for brevity in some case.</p>
  <pre class="code-block"># connect to a local server at port 8686 via RMI, naming the connection 'local-rmi'
mx&gt; <span class="sub-cmd">connect --port 8686 local-rmi</span>

# view all JMX domains
mx&gt; <span class="sub-cmd">domains</span><br />JMImplementation<br />com.sun.management<br />amx<br />amx-support<br />jmxremote<br />java.lang<br />java.util.logging

# find all MBeans in JMX domain 'amx'
mx&gt; <span class="sub-cmd">find amx:</span><br />amx:pp=,type=domain-root<br />amx:pp=/,type=J2EEDomain,j2eeType=J2EEDomain,name=amx<br />amx:pp=/,type=bulk-access
...

# find MBeans whose type is 'domain'
mx&gt; <span class="sub-cmd">find type=domain</span>
amx:pp=/,type=domain

#find MBeans whose type contains 'server' in JMX domain 'amx'
mx&gt; <span class="sub-cmd">find -w type=*server* amx:</span>
...

# target the domain config MBean, then get its attributes
mx&gt; <span class="sub-cmd">target type=domain</span>
mx&gt; <span class="sub-cmd">get Locale</span><br />---amx:pp=/,type=domain---<br />Locale=EN_US

mx&gt; <span class="sub-cmd">get *</span><br />---amx:pp=/,type=domain---<br />AmxPref=amx:type=amx-pref,pp=/domain<br />ApplicationRoot=${com.sun.aas.instanceRoot}/applications<br />Applications=amx:type=applications,pp=/domain
...

# set the Local of the domain and back
mx&gt; <span class="sub-cmd">set Locale=pidgin</span><br />---amx:pp=/,type=domain---<br />Locale=pidgin<br />mx&gt; <span class="sub-cmd">set Locale=EN_US</span><br />---amx:pp=/,type=domain---<br />Locale=EN_US

# get a java interface with docs for all amx MBeans
mx&gt; <span class="sub-cmd">java --docs amx:</span>
...

# invoke method info() on the tools MBean
mx&gt; <span class="sub-cmd">info:domain type=tools</span>
...</pre>
  <h3>2.2 Using JMX ObjectNames<a name="UsingObjectNames" id="UsingObjectNames"></a></h3>
  <p>JMX ObjectNames can be long and tedious. To address this, mx takes a 
    two-pronged approach: (1) aliases (see <a href="#Aliases">Aliases</a>), and 
    (2) shorthand notation. Shorthand notation is designed to be unambiguous, but 
    still allow increased useability. The rules are as follows:</p>
  <table width="94%" border="1">
    <tr>
      <td>#</td>
      <td><b>Rule</b></td>
      <td><b>Comments</b></td>
      <td><b>Restrictions</b></td>
    </tr>
    <tr>
      <td height="28">1</td>
      <td height="28">JMX domain may be omitted</td>
      <td height="28">Absence of a ':' in the pattern is interepreted 
        as meaning the default domain.</td>
      <td height="28"><p> The presence of a ':' disables this shortcut.</p></td>
    </tr>
    <tr>
      <td>2</td>
      <td><p>&quot;,*&quot; may be omitted at the end of a name</p></td>
      <td>If the ObjectName does not match an MBean, an implicit &quot;,*&quot; 
        is appended, and if exactly one MBean matches, then the match succeeds, 
        otherwise it fails.</td>
      <td>Adding the &quot;,* matches whatever would normally match 
        as a pattern--0 or more MBeans.</td>
    </tr>
    <tr>
      <td>3</td>
      <td>fully-specified name takes precedence</td>
      <td>Specifying an ObjectName fully will always work correctly.</td>
      <td>None.</td>
    </tr>
  </table>
  <p>Examples:</p>
  <table width="93%" border="1">
    <tr>
      <td><b>Abbreviated Name</b></td>
      <td><b>Interpretation (in precedence order):</b></td>
    </tr>
    <tr>
      <td><font size="-1" face="Courier New, Courier, mono">type=server</font></td>
      <td><p><font size="-1" face="Courier New, Courier, mono">:type=server<br />
        :type=server,*<br />
      *:type=server,*</font></p></td>
    </tr>
    <tr>
      <td><font size="-1" face="Courier New, Courier, mono">type=server,*</font></td>
      <td><font size="-1" face="Courier New, Courier, mono">:type=server,*</font></td>
    </tr>
    <tr>
      <td><font size="-1" face="Courier New, Courier, mono">:type=server</font></td>
      <td><font size="-1" face="Courier New, Courier, mono">:type=server<br />
        :type=server,*</font></td>
    </tr>
    <tr>
      <td><font size="-1" face="Courier New, Courier, mono">domain1:type=server,*</font></td>
      <td><p><font size="-1">none--same as original since both domain and &quot;,*&quot; 
        are specified</font></p></td>
    </tr>
  </table>
  <h3>2.3 Aliases<a name="Aliases" id="Aliases"></a></h3>
<p>ObjectNames can be long and unwieldy. Additionally, it may be convenient 
    to refer to more than one MBean either as a set of names or via a wildcard mechanism. 
    For this and similar reasons, mx provides the notion of <i>objectname 
      aliases</i>, hereafter referred to simply as <i>aliases</i>. An alias is simply 
    a convenient variable which contains a value that resolves to zero or more MBean 
    ObjectNames.</p>
  <p>Four commands are available for managing aliases.:create-target-alias, delete-target-alias, resolve-target-alias, list-target-aliases.</p>
<p>Once an alias has been established, 
    it may be used in place of an ObjectName. Here is an example:</p>
  <pre class="code-block">mx&gt; <span class="sub-cmd">create-target-alias amx=&quot;amx:*&quot;</span>
mx &gt; <span class="sub-cmd">get * MyMBeans</span>
...</pre>
<p>The above invocation will show all attributes available on the MBeans referred 
    to by the alias 'MyMBeans'. Aliases may be nested; they may contain other aliases 
    and even a mix of aliases an ObjectName patterns. One minor restriction is in 
    place--ObjectNames that contain a space character may not be aliased.</p>
  <h3>2.4 Default target<a name="DefaultTarget" id="DefaultTarget"></a></h3>
  <p>Most of the mx commands operation on MBeans, thus requiring and operand 
    or operands specifying the MBeans. If an operand (target) is not given, then 
    the default target is used. The default target is set using the <a href="./jmxcmd-commands.html#target">target</a> command.</p>
  <pre class="code-block">mx&gt; <span class="sub-cmd">target server:*</span>
...
<font size="-1" face="Courier New, Courier, mono">mx&gt; <span class="sub-cmd">target MyMBeans</span></font></pre>
  <h3>2.6 Specifying target(s)<a name="SpecifyingTargets" id="SpecifyingTargets"></a></h3>
  <p>Many commands take a list of targets upon which the operation acts, specified 
    as operands to the command. A target may be a fully qualified ObjectName, an 
    ObjectName pattern, or an alias, and there may be more than one of them. The 
    set of these operands and ultimately what they resolve to defines the set of 
    MBeans upon which the operation is performed. Certain special characters may 
    be used with the targets:</p>
  <ul>
    <li>the '!' character may be used to reverse the set that the target selects.</li>
    <li>with more than one operand, the '+', '-' and '&amp;' characters modify the 
      set of targets so far, from left to right. The '-' operator substracts the 
      target from the set so far, the '+' operator adds to it (same as no qualifier), 
      and the '&amp;' character performs a logical and of the target and the set 
      so far.</li>
  </ul>
  <h4>Examples:</h4>
  <p>1. Displays all MBeans not denoted by the alias &quot;MyMBeans&quot;:</p>
  <pre class="code-block">mx&gt; <span class="sub-cmd">find !MyMBeans</span></pre>
  <p>2. Displays all MBeans which have the property-pair &quot;category=config&quot; 
    and that are also in the domain &quot;Test&quot;. In this example, the target 
    &quot;category=config&quot; is an ObjectName pattern that matches any MBean 
    containing a Property &quot;category&quot; with value &quot;config&quot;. The 
    target &quot;&amp;Test:*&quot; further selects only those MBeans that are in 
    the domain &quot;Test&quot;; the &quot;&amp;&quot; specifies the intersection 
    of the &quot;Test:*&quot; expression with the &quot;category=config&quot; MBeans.</p>
  <pre class="code-block">mx&gt; <span class="sub-cmd">find category=config &amp;Test:*</span></pre>
  <p>3. Displays all MBeans that have an operation containing the string &quot;Test&quot;, 
    &quot;test&quot;, or &quot;TEST&quot; or an attribute containing &quot;Count&quot; 
    or &quot;count&quot; in the default domain that don't have an ObjectName property 
    &quot;category=config&quot;:</p>
  <pre class="code-block">mx&gt; <span class="sub-cmd">find --operations=*Test*,*test*,*TEST*  --attributes=*count*,*Count* :* -category=config</span></pre>
  <h2><a name="RevisionHistory" id="RevisionHistory"></a>Revision history <a href="#RevisionHistory" class="permalink">Permalink</a></h2>
  <dl>
    <dt>2010-01-08, v0.91</dt>
    <dd>Started</dd>
    <dt>&nbsp;</dt>
  </dl>
</div>
<div id="ft">The End</div>
</body>
</html>
