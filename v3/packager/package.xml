<?xml version="1.0" encoding="iso-8859-1"?>
<!--
 Copyright 2006 Sun Microsystems, Inc. All rights reserved.
 Use is subject to license terms.
-->

<target name="package" 
        depends="
		 package-SUNWglassfishv3-nucleus,
		 package-SUNWglassfishv3-web,
		 package-SUNWglassfishv3-common,
		 clean-tmp" >
</target>

<target name="clean-tmp" depends="publish-init"> 
    <echo message="deleting install_tmp directory"/>
    <exec dir="." executable="rm">
    	<arg line="-rf ${install.tmp.dir}"/>
    </exec>
    <echo message="deleting asman_tmp directory"/>
    <exec dir="." executable="rm">
    	<arg line="-rf ${asman.tmp.dir}"/>
    </exec>
    <exec dir="." executable="rm">
    	<arg line="-rf ${asdem.tmp.dir}"/>
    </exec>
</target>

<target name="package-SUNWglassfishv3-nucleus" 
        depends="publish-init,package-install-init"
        description="Package SUNWglassfishv3-nucleus">
    <echo message="Creating package SUNWglassfishv3-nucleus..."/>

    <mkdir dir="${basedir}/build" />
    <unzip src="${basedir}/../distributions/nucleus/target/nucleus.zip"
           dest="${basedir}/build"/>

    <antcall target="create-prototype-com">
        <param name="component.package" value="SUNWglassfishv3-nucleus"/>
        <param name="package.home" value="${package.home}"/>
        <param name="pkgname" value="nucleus"/>
    </antcall>

    <antcall target="build-solaris-package">	
        <param name="component.package" value="SUNWglassfishv3-nucleus"/>
        <param name="package.home" value="${package.home}"/>
        <param name="component.publish.home" 
               value="${install.tmp.dir}"/>
    </antcall>

    <antcall target="package-common">
        <param name="component.package" value="SUNWglassfishv3-nucleus"/>
        <param name="package.home" value="${package.home}"/>
        <param name="publish.package.home" value="${tools.package.home}"/>
        <param name="component.publish.home" value="${install.dir}/.."/>
    </antcall>

    <delete dir="${basedir}/build"/>
</target>

<target name="package-SUNWglassfishv3-web" 
        depends="publish-init,package-install-init"
        description="Package SUNWglassfishv3-web">
    <echo message="Creating package SUNWglassfishv3-web..."/>

    <mkdir dir="${basedir}/build" />
    <unzip src="${basedir}/../distributions/web/target/web.zip"
           dest="${basedir}/build"/>

    <antcall target="create-prototype-com">
        <param name="component.package" value="SUNWglassfishv3-web"/>
        <param name="package.home" value="${package.home}"/>
        <param name="pkgname" value="web"/>
    </antcall>

    <antcall target="build-solaris-package">	
        <param name="component.package" value="SUNWglassfishv3-web"/>
        <param name="package.home" value="${package.home}"/>
        <param name="component.publish.home" 
               value="${install.tmp.dir}"/>
    </antcall>

    <antcall target="package-common">
        <param name="component.package" value="SUNWglassfishv3-web"/>
        <param name="package.home" value="${package.home}"/>
        <param name="publish.package.home" value="${tools.package.home}"/>
        <param name="component.publish.home" value="${install.dir}/.."/>
    </antcall>

</target>

<target name="package-SUNWglassfishv3-common" 
        depends="publish-init,package-install-init"
        description="Package SUNWglassfishv3-common">
    <echo message="Creating package SUNWglassfishv3-common..."/>

    <antcall target="create-prototype-com">
        <param name="component.package" value="SUNWglassfishv3-common"/>
        <param name="package.home" value="${package.home}"/>
        <param name="pkgname" value="common"/>
    </antcall>

    <antcall target="build-solaris-package">	
        <param name="component.package" value="SUNWglassfishv3-common"/>
        <param name="package.home" value="${package.home}"/>
        <param name="component.publish.home" 
               value="${install.tmp.dir}"/>
    </antcall>

    <antcall target="package-common">
        <param name="component.package" value="SUNWglassfishv3-common"/>
        <param name="package.home" value="${package.home}"/>
        <param name="publish.package.home" value="${tools.package.home}"/>
        <param name="component.publish.home" value="${install.dir}/.."/>
    </antcall>

</target>

<target name="push-to-repository" 
        depends="publish-init"
        description="Publishing packages to IPS Repository ${REPO_URL}">
    <antcall target="push-package">
        <param name="pkgname" value="SUNWglassfishv3-common"/>
        <param name="pkg.dir" value="${pkgs.home}"/>
        <param name="REPO_URL" value="${REPO_URL}"/>
    </antcall>
    <antcall target="push-package">
        <param name="pkgname" value="SUNWglassfishv3-web"/>
        <param name="pkg.dir" value="${pkgs.home}"/>
        <param name="REPO_URL" value="${REPO_URL}"/>
    </antcall>
    <antcall target="push-package">
        <param name="pkgname" value="SUNWglassfishv3-nucleus"/>
        <param name="pkg.dir" value="${pkgs.home}"/>
        <param name="REPO_URL" value="${REPO_URL}"/>
    </antcall>
</target>

<target name="create-installer-ips-image" 
        depends="publish-init"
        description="Creating IPS Image without Domains for Installer">
    <antcall target="create-ips-image"/>
    <zip destfile="${image.dir}/../V3IPSImage_Installer.zip">
            <fileset dir="${image.dir}" includes="**/*" />
    </zip>
    <delete dir="${image.dir}"/>
</target>

<target name="create-glassfish-ips-image" 
        depends="publish-init"
        description="Creating IPS Image with Domains">
    <antcall target="create-ips-image"/>
    <copy todir="${image.dir}">
            <fileset dir="${install.dir}/domains"/>
    </copy>
    <zip destfile="${image.dir}/../V3IPSImage_GF.zip">
            <fileset dir="${image.dir}" includes="**/*" />
    </zip>
    <delete dir="${image.dir}"/>
</target>

<target name="create-ips-image" 
        depends="publish-init"
        description="Creating IPS Image">
    <antcall target="create-local-image">
        <param name="REPO_URL" value="${REPO_URL}"/>
    </antcall>
    <antcall target="install-package">
        <param name="pkgname" value="SUNWglassfishv3-common"/>
    </antcall>
    <antcall target="install-package">
        <param name="pkgname" value="SUNWglassfishv3-nucleus"/>
    </antcall>
    <antcall target="install-package">
        <param name="pkgname" value="SUNWglassfishv3-web"/>
    </antcall>
</target>
