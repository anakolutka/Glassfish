/*
 * Copyright 2006 Sun Microsystems, Inc. All rights reserved.
 * Use is subject to license terms.
 */
package com.sun.enterprise.ee.server;

import com.sun.enterprise.server.TomcatServices;
import com.sun.enterprise.server.pluggable.InternalServicesList;
import com.sun.enterprise.admin.server.core.AdminService;

/**
 * pluggable interface (this class will provide ApplicationServer
 * with the right lifecycles array)
 */
public class EETomcatServices extends TomcatServices 
    implements  InternalServicesList
{
    private final String JESMF_LIFECYCLE_CLASS
        = "com.sun.enterprise.ee.admin.jesmf.lifecycle.JESMFLifeCycle";

    public String[][] getServicesByName() {
        final String[][] services = super.getServicesByName();
        final int size = services.length;

        int extraServices;

        try {
            Class.forName(JESMF_LIFECYCLE_CLASS);
            extraServices = 5;   //FIXME HACK: if JESMFLifeCycle class present
        } catch (Exception ex) {
            extraServices = 4;  //Else
        }

        final String[][] result = new String[size + extraServices][];
        result[0] = services[0];//AdminService continues as first service
        //GMS is the second service
        result[1] = new String[] {"GroupManagementService",
            "com.sun.enterprise.ee.cms.lifecycle.GMSLifecycleImpl"};
        for (int i = 1; i < size; i++) {
            result[i+1] = services[i];
        }

        //EJBComponent
        result[size+1] = new String[] {"EJBComponentService", 
            "com.sun.ejb.ee.timer.lifecycle.EJBLifecycleImpl"};

        // cascading
        result[size+2] = new String[] {"Cascading",
            "com.sun.enterprise.ee.admin.cascading.CascadingLifecycleImpl"};

        // loadbalancer
        result[size+3] = new String[] {"Loadbalancer",
                "com.sun.enterprise.ee.admin.lbadmin.lifecycle.LoadbalancerAdminLifeCycle"};

        // jes-mf
        if (extraServices == 5)  //FIXME HACK 
        {
            result[size+4] = new String[] {"JESMF",
               "com.sun.enterprise.ee.admin.jesmf.lifecycle.JESMFLifeCycle"};
        }        
        return result;
   }
}
