<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<sun:page xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:sc="http://java.sun.com/mojarra/scales"
      xmlns:sun="http://www.sun.com/webui/webuijsf"
      xmlns:jsfExt="http://java.sun.com/jsf/extensions/dynafaces">
<ui:event type="initPage">
    setResourceBundle(key="i18n" bundle="org.glassfish.admingui.core.Strings");
    getAmxRoot(amxRoot=>$attribute{amxRoot});
    setAttribute(key="anonLogin", value="#{amxRoot.realmsMgr.anonymousLogin}");
</ui:event>

<sun:html>
    <ui:event type="beforeCreate">
        setResourceBundle(key="i18n" bundle="org.glassfish.admingui.core.Strings");
        setResourceBundle(key="help" bundle="org.glassfish.admingui.core.Helplinks");

        checkSupport(supportCluster=>$session{supportCluster});
        if( $session{supportCluster}){
            initClusterSessionAttribute();
            setSessionAttribute(key="notSupportCluster" value="$boolean{false}");
        }
        if(! $session{supportCluster}){
            setSessionAttribute(key="notSupportCluster" value="$boolean{true}");
        }

        showRegistration(value=>$session{showRegistration});
        if ($session{showRegistration}){
            setRegistrationNodeText();
        }


        if(! $session{supportCluster}){
            checkRestart(RestartRequired=>$session{restartRequired},
            unprocessedChanges=>$session{unprocessedChanges});
        }
        if($session{supportCluster}){
            setSessionAttribute(key="restartRequired" value="$boolean{false}");
        }
    </ui:event>
    <sun:head>
        <title><ui:insert name="title">GlassFish v3 Administration Console</ui:insert></title>
        <link rel="stylesheet" type="text/css" href="#{facesContext.externalContext.request.contextPath}/style.css" />
        <sc:links/>
        <sun:script url="/resource/js/adminjsf.js" />
        <jsfExt:scripts/>
    </sun:head>

    <sun:body>
        <div class="header_main">
            <sun:form id="headerForm">
                <!-- Customizing the masthead -->
                <ui:event type="afterCreate">
                    getClientId(component="$this{component}" clientId=>$attribute{formId})
                    getUIComponent(clientId="#{formId}"  component=>$attribute{component})
                    includeFirstIntegrationPoint(type="org.glassfish.admingui:masthead" root="#{component}");
                </ui:event>
            </sun:form>
            <sc:menuBar width="100%">
                <sc:menuItem value="Dashboard" url="#{request.contextPath}/commonTask.jsf"/>
                <sc:subMenu value="Configure">
                    <sc:menuItem value="Applications" url="#{request.contextPath}/web/webApp/webApplications.jsf"/>
                </sc:subMenu>
                <sc:subMenu value="Monitor"></sc:subMenu>
                <sc:subMenu value="Utilities">
                    <sc:menuItem value="Update Center" url="#{request.contextPath}/updateCenter/addOn.jsf"/>
                </sc:subMenu>
            </sc:menuBar>
        </div>
        <div id="content" style="padding-left: 5px; padding-right: 5px;">
            <h:messages />
            <ui:insert name="content">
                Something's wrong!
            </ui:insert>
        </div>
        <sc:panel id="addTagPanel" visible="false" modal="true" closable="true" fixedCenter="true">
            <h3>Tag the Current Page</h3>
            <h:form id="tagForm">
                <div style="width:40px; float: left">Tag:</div>
                <h:inputText id="tag" value="#{requestScope.tag}"/>
                <br/>
                <div style="width:40px; float: left">Name:</div>
                <h:inputText id="name" value="#{requestScope.tagName}"/>
                <h:inputHidden id="url" value="#{requestScope.url}"/>
                <br/>
                <h:commandButton id="addTagButton" value="Add Tag" onclick="submitTagForm(this); return false;">
                    <ui:event type="command">
                        saveTagInformation(tag="$attribute{tag}", name="$attribute{tagName}", url="#{requestScope.url}");
                        setAttribute(key="tag" value="");
                        setAttribute(key="tagName" value="");
                    </ui:event>
                </h:commandButton>
            </h:form>
        </sc:panel>
        <sc:panel id="searchTagsPanel" visible="false" modal="true" closable="true" fixedCenter="true" width="800px">
            <h3>Search Tags</h3>
                <div style="width:40px; float: left">Tag:</div>
                <h:form id="tagSearch">
                    <h:inputText id="tag" value="#{requestScope.tag}"/>
                    <h:commandButton id="searchTagButton" value="Search" onclick="submitTagSearchForm(this); return false;">
                        <ui:event type="command">
                            searchTags(tag="$attribute{tag}", hits=>$pageSession{tagSearchHits});
                            setAttribute(key="tag" value="");
                        </ui:event>
                    </h:commandButton>
                </h:form>
                <br/>
                <div style="height: 300px; overflow: auto;">
                    <h:panelGroup id="hits">
                        "$pageSession{tagSearchHits}"
                        <ul>
                        <ui:repeat var="hit" value="$pageSession{tagSearchHits}">
                            <li>Hello: <a href="#{hit.url}">#{hit.name}</a> - #{hit}</li>
                        </ui:repeat>
                        </ul>
                    </h:panelGroup>
                </div>
        </sc:panel>
        <script type="text/javascript">
            function submitTagForm(el) {
                YAHOO.util.Dom.get('tagForm:url').value = window.location;
                DynaFaces.fireAjaxTransaction(el,
                    {
                        execute: 'tagForm:tag,tagForm:name,tagForm:url,'+el.id,
                        inputs: 'tagForm:tag,tagForm:name,tagForm:url,'+el.id,
                        render: 'tagForm:tag,tagForm:name,tagForm:url,'+el.id,
                        replaceElement: function() {
                            hidePanel('addTagPanel');
                            YAHOO.util.Dom.get('tagForm:tag').value = '';
                            YAHOO.util.Dom.get('tagForm:name').value = '';
                        }
                    } );
            }

            function submitTagSearchForm(el) {
                DynaFaces.fireAjaxTransaction(el,
                    {
                        execute: 'hits,tagSearch:tag,'+el.id,
                        inputs: 'hits,tagSearch:tag,'+el.id,
                        render: 'hits',
                        postReplace: function(zone, html, closure, xjson) {
                            alert('post replace for' + zone.id + ': ' + html);
                        },
                        replaceElement: function() {
                            YAHOO.util.Dom.get('tagSearch:tag').value = '';
                        }
                    } );
            }
        </script>
    </sun:body>
</sun:html>

</sun:page>
