<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <meta http-equiv="CONTENT-TYPE" content="text/html; charset=utf-8">
  <title>GlassFish - Java Persistence API FAQ</title>
  <meta name="GENERATOR" content="OpenOffice.org 2.0  (Linux)">
  <meta name="CREATED" content="20060420;9392900">
  <meta name="CHANGEDBY" content="Sanjeeb Kumar Sahoo">
  <meta name="CHANGED" content="20060808;13331200">
  <style>
	<!--
		@page { size: 8.5in 11in }
		P { color: #000000; line-height: 100% }
		P.western { font-family: "Courier", monospace; font-size: 10pt }
		H3 { color: #000000 }
		H4 { color: #000000 }
	-->
	</style>
</head>
<body lang="en-US" text="#000000" bgcolor="#ffffff" dir="ltr">
<div id="projecthome" dir="ltr"> <b><font size="4">GlassFish Project -
Java Persistence API - Frequently Asked Questions&nbsp;<!--BODY LANG="en-US" DIR="LTR"--></font></b>
<p class="western"> </p>
<h3>Table of Contents</h3>
<ul>
  <li>
    <p class="western" style="margin-bottom: 0in;"><!--mozToc h4 1--><a
 href="#mozTocId701421">XML and Packaging</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a
 href="#mozTocId400274">O/R Mapping and Annotation</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a
 href="#mozTocId153526">Automatic Table Generation (Java2DB)</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a
 href="#mozTocId867224">Dependency Injection, JNDI lookup, EntityManager</a>
    </p>
  </li>
  <li>
    <p class="western"><a href="#mozTocId878282">Miscellaneous questions</a>
    </p>
  </li>
</ul>
<h4><a name="mozTocId701421"></a><b><font size="3">A. XML and Packaging</font></b></h4>
<p class="western"> </p>
<ol>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#1">What
does the simplest persistence.xml look like on the Java EE platform?</a>
    </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#2">How
does my persistence.xml file vary between the Java EE and the Java SE
environments?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#3">I am
getting an XML validation error “Cannot find the declaration of element
'persistence'”. What could be going wrong?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#4">Is
there a standard name for the XML mapping file?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#5">Can I
name my XML mapping file as anything other than META-INF/orm.xml?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#6">I am
writing a simple web application that uses the Java Persistence API.
How should I package my entity classes?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#7">I am
writing an enterprise application (ear) that uses the Java Persistence
API. How can I package my persistence classes?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#8">Can I
use the Java Persistence API in a Java EE client application?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#9">I have
an ear file which has an ejb-jar file and a war file. The ejb-jar
defines a persistence unit. Can my web module use that persistence unit?</a>
    </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#10">Can I
share a persistence context across multiple applications?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#11">Can I
share a persistence context among multiple modules in an application
(ear)?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#12">How
should I package my persistence classes so that I can share the
persistence context among different modules in the application?</a> </p>
  </li>
  <li>
    <p class="western"><a href="#13">I am getting
“java.lang.IllegalArgumentException: Invalid ejb jar my-ejb.jar...”</a>
    </p>
  </li>
</ol>
<h4><a name="mozTocId400274"></a><font size="3"><b>B. O/R Mapping and
Annotation</b></font></h4>
<ol>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#14">How do
I specify the default values for <b>schema</b> or <b>catalog</b>
names for my persistence unit?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#15">I am
trying to persist a generic class, but
MetaDataHelper.getReturnTypeFromGeneric() throws an exception.</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#16">I am
getting an Exception that says “Exception Description: Multiple
writable mappings exist for the field ...”</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#17">I am
using @Id in my entity class, yet I am getting a TopLink exception:
“Exception Description: Entity class [class xxx] has no primary key
specified. It should define either an @Id, @EmbeddedId or an @IdClass.”</a>
    </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#18">I have
a relationship set up between my entities. When I set one side of the
relationship, the change is not reflected in other side. This used to
work in CMP 2.x. What has changed?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#19">When I
am accessing my entities, I get a database exception because incorrect
column names are used by TopLink Essentials.</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#20">Can I
have my entity data spread across multiple tables?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#21">Can I
use a non-primary key type column as an Id (@Id) field in my entity?</a>
    </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#22">I am
not able to locate javax.persistence.AccessType.class. How do I specify
access-type for my entity class?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#23">Can I
use a NamedQuery annotation to annotate an embeddable class or
MappedSuperclass?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#36">How do
I specify access-type in my entity class?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#37">Is it
possible to mix access-types in an inheritance hierarchy?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#38">Is it
possible for an embeddable class to have a different access-type than
the entity class that embeds that type?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#39">Should
I make my entity Serializable?</a> </p>
  </li>
  <li>
    <p class="western"><a href="#40">What's the difference between
@IdClass and @EmbeddedId?</a> </p>
  </li>
</ol>
<h4><a name="mozTocId153526"></a><font size="3"><b>C. Automatic Table
Generation (Java2DB)</b></font></h4>
<ol>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#24">Is
there a way to generate tables and columns for my persistence
application?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#25">I am
using Java2DB in my application, does it make my application
non-portable?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#26">How do
I generate the tables with some specific columns being indexed?</a> </p>
  </li>
  <li>
    <p class="western"><a href="#27">Does Java2DB generate constraints
in the database?</a> </p>
  </li>
</ol>
<h4><a name="mozTocId867224"></a><font size="3"><b>D. Dependency
Injection, JNDI lookup, EntityManager</b></font></h4>
<ol>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#28"><span
 style="text-decoration: none;">I am getting a NullPointerException in
my web application while trying to use the injected EntityManager. What
is the problem?</span></a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#29"><span
 style="text-decoration: none;">How should I get hold of an
EntityManager in my Servlet?</span></a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#30"><span
 style="text-decoration: none;">Can I use
javax.persistence.Persistence.createEntityManagerFactory() to get hold
of an EntityManagerFactory in my web application?</span></a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#31"><span
 style="text-decoration: none;">Can I use a resource-local
EntityManager in my web application?</span></a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#32">I am
calling merge, yet the entity state is detached. What am I doing wrong?</a>
    </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#33">I have
called em.merge(e) and yet I am getting an IllegalArgumentException
while trying to delete an entity from the database using em.remove(e).
What am I doing wrong?</a> </p>
  </li>
  <li>
    <p class="western"><a href="#34">EntityManager.persist() throws
TransactionRequiredException in a servlet. What am I doing wrong?</a> </p>
  </li>
</ol>
<h4><a name="mozTocId878282"></a><font size="3"><b>E. </b></font>Miscellaneous<font
 size="3"><b> questions</b></font></h4>
<ol>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#35">
 I am getting a java.security.PrivilegedActionException : Error opening socket to
server localhost on port 1527 message : nullError Code: 0.
What am I doing wrong?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#41"><span
 style="text-decoration: none;">What is the purpose of -javaagent
option? What happens if I don't use it?</span></a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#42">How
can I configure the cache used by TopLink Essentials?</a> </p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#44">How do
I configure the logging level for Toplink Essentials?</a></p>
  </li>
  <li>
    <p class="western" style="margin-bottom: 0in;"><a href="#45">How
can I see the sql generated by Toplink Essentials?</a></p>
  </li>
  <li>
    <p class="western"><a href="#43">How can I control the connection
pool settings for an entity manager in a Java SE environment?</a> </p>
  </li>
</ol>
<h3>Answers</h3>
<h4><font face="Courier, monospace"><font size="3"><b>XML and Packaging
related questions</b></font></font></h4>
<a name="1"></a><i><font color="#ff0000">Q. What does the simplest
persistence.xml look like on the Java EE platform?</font></i> <br>
<p class="western" style="margin-bottom: 0in;"><code>&lt;persistence
xmlns="http://java.sun.com/xml/ns/persistence" version="1.0"&gt;</code></p>
<p class="western" style="margin-left: 0.42in; margin-bottom: 0in;"><code>&lt;persistence-unit
name="xxx"/&gt;</code></p>
<p class="western" style="margin-bottom: 0in;"><code>&lt;/persistence&gt;</code></p>
<span style="font-family: &quot;courier&quot;,monospace;"><br>
</span> <a name="2"></a><i><font color="#ff0000">Q. How does my
persistence.xml file vary between the Java EE and the Java SE
environments?</font></i> <br>
<br>
In the Java SE, datasource is not supported, so you have to specify
database properties using <b>&lt;properties&gt;</b> as shown below.
Moreover, there are a few important ways persistence.xml varies between
the Java EE and the Java SE environments: e.g. you have to specify
provider name using the &lt;provider&gt; element, list all managed
classes using the &lt;class&gt; element and only RESOURCE_LOCAL
transaction type is supported. In Java SE, a typical persistence.xml
file looks like this: <br>
<p class="western" style="margin-bottom: 0in;"><code>&lt;persistence
xmlns=”<a href="http://java.sun.com/xml/ns/persistence">http://java.sun.com/xml/ns/persistence</a>”
version=”1.0”&gt;</code></p>
<p class="western" style="margin-left: 0.42in; margin-bottom: 0in;"><code>&lt;persistence-unit
name=<font color="#000000">"xxx"</font> transaction-type=<font
 color="#000000">"RESOURCE_LOCAL"</font>&gt;</code></p>
<p class="western" style="margin-left: 0.83in; margin-bottom: 0in;"><code>&lt;provider&gt;oracle.toplink.essentials.ejb.cmp3.EntityManagerFactoryProvider&lt;/provider&gt;</code><br>
<code>&lt;class&gt;entity1&lt;/class&gt;</code><br>
<code>&lt;class&gt;entity2&lt;/class&gt;</code><br>
<code>&lt;properties&gt;</code></p>
<p class="western" style="margin-left: 1.25in; margin-bottom: 0in;"><code>&lt;property
name=<font color="#000000">"toplink.jdbc.driver"</font> value=<font
 color="#000000">"org.apache.derby.jdbc.ClientDriver"</font>/&gt;</code><br>
<code>&lt;property name=<font color="#000000">"toplink.jdbc.url"</font>
value=<font color="#000000">"jdbc:derby://localhost:1527/sun-appserv-samples"</font>/&gt;</code><br>
<code>&lt;property name=<font color="#000000">"toplink.jdbc.user"</font>
value=<font color="#000000">"APP"</font>/&gt;</code><br>
<code>&lt;property name=<font color="#000000">"toplink.jdbc.password"</font>
value=<font color="#000000">"APP"</font>/&gt;</code></p>
<p class="western"
 style="margin-left: 1.25in; text-indent: -0.4in; margin-bottom: 0in;">
<code>&lt;/properties&gt;</code></p>
<p class="western"
 style="margin-left: 1.25in; text-indent: -0.8in; margin-bottom: 0in;">
<code>&lt;/persistence-unit&gt;</code></p>
<p class="western" style="margin-bottom: 0in;"><code>&lt;/persistence&gt;</code></p>
<br>
<a name="3"></a><i><font color="#ff0000">Q. I am getting an XML
validation error “Cannot find the declaration of element
'persistence'”. What could be going wrong?</font></i><br>
<br>
It is likely that you are you not using the namespace or using an
incorrect namespace in your persistence.xml file. You must use
namespace and supply the correct value for it as shown below: <br>
<p class="western" style="margin-bottom: 0in;"><code>&lt;persistence
xmlns="http://java.sun.com/xml/ns/persistence" version="1.0"&gt;</code></p>
<p class="western" style="margin-left: 0.42in; margin-bottom: 0in;"><code>&lt;persistence-unit
...</code></p>
<p class="western" style="margin-bottom: 0in;"><code>&lt;/persistence&gt;</code></p>
<br>
Refer to <a
 href="https://glassfish.dev.java.net/issues/show_bug.cgi?id=579">issue
#579</a> for more discussion on this issue. <br>
<br>
<a name="4"></a><i><font color="#ff0000">Q. Is there a standard name
for the XML mapping file?</font></i> <br>
<br>
Yes, there is a default name for this file. It is called <b>META-INF/orm.xml</b>.
But, this file need <b>not</b> always be called META-INF/orm.xml file.
You can give any name you like (see next question), but there is a
definite advantage if you use the default name and location. That way
you don't have to specify the name in persistence.xml file. Just
package the XML mapping file in your jar as META-INF/orm.xml. Refer to
section #<b>6.2.1.6</b> of the spec for more details. <br>
<br>
<a name="5"></a><i><font color="#ff0000">Q. Can I name my XML mapping
file as anything other than META-INF/orm.xml?</font></i> <br>
<br>
Yes, you can name it anything you like. Remember that, if the mapping
file is packaged as META-INF/orm.xml, then you don't have to do
anything special. Otherwise, you should use <b>&lt;mapping-file&gt;</b>
element in the persistence.xml file. Please also note that the name you
specify using mapping-file element is not relative to the
persistence.xml. Instead, at runtime it is used in a call like <b>ClassLoader#findResourceByName()</b>
. <br>
e.g. If you have packaged your jar file to look like this: <br>
<p class="western" style="margin-bottom: 0in;"><code></code></p>
<p class="western" style="margin-bottom: 0in;"><code>ejb.jar/</code></p>
<p class="western" style="margin-left: 0.42in; margin-bottom: 0in;"><code>META-INF/persistence.xml</code></p>
<p class="western" style="margin-left: 0.83in; margin-bottom: 0in;"><code>&nbsp;&nbsp;
/mappings.xml</code></p>
<br>
then, the mapping-file element should look like this:<br>
<p class="western" style="margin-bottom: 0in;"><code>&lt;mapping-file&gt;META-INF/mappings.xml&lt;/mapping-file&gt;</code></p>
<span style="font-family: &quot;courier&quot;,monospace;"></span> <br>
<a name="6"></a><font color="#ff0000"><i>Q. I am writing a simple web
application that uses the Java Persistence API. How should I package my
entity classes?</i></font> <br>
<br>
There are several ways to package your entity classes: <br>
<br>
a) package all the entity classes along with META-INF/persistence.xml
in a jar file, say 'entities.jar', and put it in WEB-INF/lib as shown
below:
<p class="western" style="margin-bottom: 0in;"><code>foo.war/</code></p>
<p class="western" style="margin-left: 0.42in; margin-bottom: 0in;"><code>WEB-INF/lib/entities.jar</code></p>
<p class="western" style="margin-bottom: 0in;"><code><br>
</code></p>
where entities.jar look like this:<br>
<p class="western" style="margin-bottom: 0in;"><code>entities.jar/</code></p>
<p class="western" style="margin-left: 0.42in; margin-bottom: 0in;"><code>META-INF/persistence.xml</code><br>
<code>pkg/Entity1.class</code><br>
<code>pkg/Entity2.class</code></p>
<p class="western" style="margin-bottom: 0in;"><code><br>
</code></p>
b) package all the entity classes along with META-INF/persistence.xml
in WEB-INF/classes as shown below:<br>
<p class="western" style="margin-bottom: 0in;"><code>foo.war/</code></p>
<p class="western" style="margin-left: 0.42in; margin-bottom: 0in;"><code>WEB-INF/classes/</code><br>
<code>META-INF/persistence.xml</code><br>
<code>pkg/Entity1.class</code><br>
<code>pkg/Entity2.class</code></p>
<code></code><br>
For more information on this, refer to <a
 href="http://weblogs.java.net/blog/ss141213/archive/2005/12/introduction_to.html">Introduction
to using Java Persistence API in a web application in Java EE
environment.</a> <br>
<br>
<a name="7"></a><i><font color="#ff0000">Q. I am writing an enterprise
application (ear) that uses the Java Persistence API. How can I package
my persistence classes?</font></i> <br>
<br>
There are several ways to package your persistence classes. We
recommend the following structure for your ear file:<br>
<p class="western" style="margin-bottom: 0in;"><code>a.ear/</code></p>
<p class="western" style="margin-left: 0.42in; margin-bottom: 0in;"><code>ejb.jar</code><br>
<code>foo.war</code><br>
<code>lib/my-pu.jar</code></p>
<p class="western" style="margin-bottom: 0in;">&nbsp;<br>
</p>
For more details, refer to <a
 href="http://weblogs.java.net/blog/ss141213/archive/2005/12/using_java_pers.html">Using
Java Persistence API in Java EE Platform - Part II</a> <br>
<br>
<a name="8"></a><i><font color="#ff0000">Q. Can I use the Java
Persistence API in a Java EE client application?</font></i> <br>
<br>
Yes. See <a
 href="http://weblogs.java.net/blog/ss141213/archive/2006/03/using_java_pers_1.html">Using
Java Persistence API in application client in Java EE platform</a> <br>
<br>
<a name="9"></a><i><font color="#ff0000">Q. I have an ear file which
has an ejb-jar file and a war file. The ejb-jar defines a persistence
unit. Can my web module use that persistence unit?</font></i> <br>
<br>
No. When a persistence unit is packaged inside a module like ejb-jar or
war, it is private to that module. For a persistence unit to be visible
to all modules, it needs to be packaged in a library jar file in the
ear file. We recommend you use ear/lib directory for this purpose. e.g.<br>
<p class="western" style="margin-bottom: 0in;"><code>a.ear/</code></p>
<p class="western" style="margin-left: 0.42in; margin-bottom: 0in;"><code>ejb.jar</code><br>
<code>foo.war</code><br>
<code>lib/my-pu.jar</code></p>
<br>
<a name="10"></a><i><font color="#ff0000">Q. Can I share a persistence
context among multiple applications?</font></i> <br>
<br>
No, this is not possible because each application uses a different
classloader in the same JVM. <br>
<br>
<a name="11"></a><i><font color="#ff0000">Q. Can I share a persistence
context among multiple modules in an application (ear)?</font></i> <br>
<br>
Yes it is possible to share the persistence context among multiple
modules in an application when the modules use local calling semantics,
e.g. Servlet -&gt; local EJB -&gt; local EJB or EJB1 -&gt; EJB2. Note
that, you can't share the persistence context across remote EJB calls. <br>
<br>
<a name="12"></a><i><font color="#ff0000">Q. How should I package my
persistence classes so that I can share the persistence context among
different modules in the application?</font></i> <br>
<br>
You must use an ear-scoped persistence unit, i.e. you must package
persistence entity classes in a library jar file. <br>
<br>
<a name="13"></a><i><font color="#ff0000">Q. I am getting
“java.lang.IllegalArgumentException: Invalid ejb jar my-ejb.jar: it
contains zero ejb. A valid ejb jar requires at least one
session/entity/message driven bean” although my jar file contains some
@Entity annotated classes. What am I doing wrong?</font></i> <br>
<br>
It is very likely that you have packaged only entity (@Entity) classes
in that jar file and you have designated that jar file as an EJB module
either by having an empty ejb-jar.xml inside it or by specifying
&lt;module&gt;ejb&lt;/module&gt; in application.xml. In EJB 3.0, an
@Entity annotated class is no longer an EJB because it can be used
outside the EJB container. So, don't specify that jar file as an
ejb-jar. For further details, refer to this forum discussion: <a
 href="http://forums.java.net/jive/thread.jspa?forumID=56&amp;threadID=16319">http://forums.java.net/jive/thread.jspa?forumID=56&amp;threadID=16319</a>
<p class="western"> </p>
<h4>O/R Mapping and annotation related questions </h4>
<a name="14"></a><i><font color="#ff0000">Q. How do I specify the
default values for <b>schema</b> or <b>catalog</b> names for my
persistence unit?</font></i> <br>
<br>
You can use an XML mapping file to specify default values for
information that applies to the entire persistence unit, e.g.
schema/catalog name, access-type etc. e.g. to specify the <b>schema</b>
name for the entire persistence unit, provide an <b>orm.xml</b> that
looks like this:<br>
<p class="western">&lt;entity-mappings
xmlns="http://java.sun.com/xml/ns/persistence/orm" version="1.0"&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;persistence-unit-metadata&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;persistence-unit-defaults&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;
&lt;schema&gt;TestSchema&lt;/schema&gt;<br>
&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;/persistence-unit-defaults&gt;<br>
&nbsp;&nbsp;&nbsp; &lt;/persistence-unit-metadata&gt;<br>
&lt;/entity-mappings&gt;<br>
<br>
</p>
Look at <a
 href="https://glassfish.dev.java.net/issues/show_bug.cgi?id=580">issue
#580</a> for a discussion on this issue. <br>
<br>
<a name="15"></a><i><font color="#ff0000">Q. I am trying to persist a
generic class, but MetaDataHelper.getReturnTypeFromGeneric() throws an
exception. My entity looks like this:</font></i> <br>
<i><font color="#ff0000">@Entity</font></i><br>
<i><font color="#ff0000">public class Foo&lt;T extends Bar&gt; extends
FooBar {</font></i><br>
<i><font color="#ff0000">private List&lt;T&gt; myVar = new
ArrayList&lt;T&gt;();</font></i><br>
<i><font color="#ff0000">...</font></i><br>
<i><font color="#ff0000">}</font> </i><br>
<br>
This is not allowed. Refer to <a
 href="http://forums.java.net/jive/thread.jspa?threadID=14190">http://forums.java.net/jive/thread.jspa?threadID=14190</a>
for more discussion on this.<br>
&nbsp;<br>
<a name="16"></a><i><font color="#ff0000">Q. I am getting an exception
from TopLink that says “Exception Description: Multiple writable
mappings exist for the field ...”</font></i> <br>
<br>
This happens when you are trying to map multiple entity fields or
properties to the same column in the database. Annotate all but one of
them as read-only by using updatable=false,insertable=false. This can
be used both for @Column as well as @JoinColumn annotations. Refer to <a
 href="http://forums.java.net/jive/thread.jspa?threadID=14559">http://forums.java.net/jive/thread.jspa?threadID=14559</a>
for a complete example that shows how to use this feature. <br>
<br>
<a name="17"></a><i><font color="#ff0000">Q. I am using @Id in my
entity class, yet I am getting a TopLink exception: “Exception
Description: Entity class [class xxx] has no primary key specified. It
should define either an @Id, @EmbeddedId or an @IdClass.”</font></i> <br>
<br>
It is very likely that you are using mixed access-type in your entity
hierarchy. i.e. both fields and properties are annotated in your entity
class hierarchy. Fix it to use a single access type. Refer to <a
 href="https://glassfish.dev.java.net/issues/show_bug.cgi?id=353">https://glassfish.dev.java.net/issues/show_bug.cgi?id=353</a>
for further information. <br>
<br>
<a name="18"></a><i><font color="#ff0000">Q. I have a relationship set
up between my entities. When I set one side of the relationship, the
change is not reflected in other side. This used to work in CMP 2.x.
What has changed?</font></i> <br>
<br>
Relationship management has <b>changed</b> in the Java Persistence API
spec. In section #3.2.3, the spec says the following: <br>
“Bidirectional relationships between managed entities will be persisted
based on references held by the<br>
owning side of the relationship. It is the developer’s responsibility
to keep the in-memory references<br>
held on the owning side and those held on the inverse side consistent
with each other when they change. <br>
Developers may choose whether or not to update references<br>
held by the inverse side when the owning side changes, depending on
whether the application can handle out-of-date references on the
inverse side until the next database refresh occurs.” <br>
This means you have to maintain relationships just like you do in your
Java programs: if you want both sides of your relationship to be
updated, then you have to do it in your program itself. Refer to this
forum topic: <br>
<a href="http://forums.java.net/jive/thread.jspa?threadID=2657">http://forums.java.net/jive/thread.jspa?threadID=2657</a>
<br>
<br>
<a name="19"></a><i><font color="#ff0000">Q. When I am accessing my
entities, I get a database exception because incorrect column names are
used by TopLink Essentials.</font></i> <br>
<br>
This typically happens when a user does not specify column names,
either using annotations like @Column or @JoinColumn, or using orm.xml
file. In such cases, TopLink computes column names based on rules
defined in the spec. If the actual database schema differs from the
names TopLink comes up with, you shall see such exceptions. To fix
this, either you have to change your database schema or specify columns
names in your application. Currently, there is no provision in TopLink
Essentials to validate the <b>expected</b> schema against the <b>actual</b>
database schema. So, you can discover such issues only by testing. <br>
<br>
<a name="20"></a><i><font color="#ff0000">Q. Can I have my entity data
spread across multiple tables?</font></i> <br>
<br>
Yes, for every entity, there must be a primary table designated using
@Table and zero or more secondary tables designated using
@SecondaryTable. <br>
<br>
<a name="21"></a><i><font color="#ff0000">Q. Can I use a non-primary
key type column as an Id (@Id) field in my entity?</font></i> <br>
<br>
Yes, you can designate any column of the primary table as an Id field
in your entity, but make sure that there are no duplicate entries for
that column. We suggest you have a unique constraint for such a column.
<br>
<br>
<a name="22"></a><i><font color="#ff0000">Q. I am not able to locate
javax.persistence.AccessType.class. How do I specify access-type for my
entity class?</font></i> <br>
<br>
In the early draft release of the Java Persistence API spec, this class
was there. Later on, the spec was changed. The user no longer has to
use this class. A persistence provider <b>automatically</b> figures
out if your bean is annotating fields or methods by looking at the
class definition. See the latest Entity.java file:<br>
<br>
<a
 href="https://glassfish.dev.java.net/source/browse/glassfish/persistence-api/src/java/javax/persistence/Entity.java?rev=HEAD&amp;view=auto&amp;content-type=text/vnd.viewcvs-markup">https://glassfish.dev.java.net/source/browse/glassfish/persistence-api/src/java/javax/persistence/Entity.java?rev=HEAD&amp;view=auto&amp;content-type=text/vnd.viewcvs-markup</a><br>
<br>
So it is sufficient to say the following:<br>
<p class="western"><br>
<code>@Entity <br>
public class Person {</code></p>
<p class="western" style="margin-left: 0.42in; margin-bottom: 0in;"><code>@Id
private String ssn;</code></p>
<p class="western"><code>}</code><br>
</p>
or<br>
<p class="western"><code>@Entity public class Person {</code></p>
<p class="western" style="margin-left: 0.42in; margin-bottom: 0in;"><code>private
String ssn;<br>
<br>
@Id public String getId(){return id;}</code><br>
<code>public void setId(String id) {this.id = id;}</code></p>
<p class="western"><code>}</code><br>
</p>
Of course <b>it is an error if you annotate both fields and methods at
the same time. </b><br>
<br>
<a name="23"></a><i><font color="#ff0000">Q. Can I use a NamedQuery
annotation to annotate an embeddable class or MappedSuperclass?</font></i>
<br>
<br>
No, it can only be used for entity classes. <br>
<br>
<a name="36"></a><i><font color="#ff0000">Q. How do I specify
access-type in my entity class?</font></i> <br>
<br>
When you use annotations in your entity class, access-type is implicit,
i.e. placement of O/R annotations in field or property accessor method
automatically determines the access-type for your class. When you are
using a mapping XML file, access-type can be specified using
&lt;access&gt; element. It is an error to mix access-types in an
inheritance hierarchy. <br>
<br>
<a name="37"></a><i><font color="#ff0000">Q. Is it possible to mix
access-types in an inheritance hierarchy?</font></i> <br>
<br>
No, all classes in an inheritance hierarchy must use the same
access-type. See question above as well. <br>
<br>
<a name="38"></a><i><font color="#ff0000">Q. Is it possible for an
embeddable class to have a different access-type than the entity class
that embeds that type?</font></i> <br>
<br>
No, you must use the same access-type for the embeddable as you do in
the entity class where you use the embeddable class. As a side effect,
you can't use the embeddable class in different entity classes with
conflicting access-types. <br>
<br>
<a name="39"></a><i><font color="#ff0000">Q. Should I make my entity
Serializable?</font></i> <br>
<br>
Yes, you should. Although it is <b>not</b> necessary, it is
never-the-less a good practice to make your entity class Serializable
so that it is ready to be used in a remote invocation. Otherwise you
can't return an entity in a remote business interface of an EJB. <br>
<br>
<a name="40"></a><i><font color="#ff0000">Q. What's the difference
between @IdClass and @EmbeddedId?</font></i> <br>
<br>
<span style="text-decoration: none;">There is not much difference.
Refer to <a
 href="http://forums.java.net/jive/thread.jspa?threadID=17026">http://forums.java.net/jive/thread.jspa?threadID=17026</a>
where this is discussed.</span>
<p class="western"> </p>
<h4>Automatic Table Generation (Java2DB) related questions </h4>
<a name="24"></a><i><font color="#ff0000">Q. Is there a way to generate
tables and columns for my persistence application?</font></i> <br>
<br>
Yes, the Java Persistence API spec defines an API for users to specify
database schema information that a provider can use to define the
schema in a database. In GlassFish, this feature is known as <b>Java2DB</b>.
Refer to the following link for more information: <a
 href="http://blogs.sun.com/roller/page/java2dbInGlassFish">http://blogs.sun.com/roller/page/java2dbInGlassFish</a>
<br>
<br>
<a name="25"></a><i><font color="#ff0000">Q. I am using Java2DB in my
application, does it make my application non-portable?</font></i> <br>
<br>
Theoretically, <b>yes,</b> because although the&nbsp; Java Persistence
API spec defines API for users to specify database schema information
that a provider can use to define the schema in a database, this is an <b>optional</b>
feature and is not <b>required</b> to be supported by every compliant
persistence provider. But practically speaking, the answer is <b>no</b>
because most popular persistence providers support this. Moreover, your
mapping specification is totally portable; it's only the generation of
DDL feature which may not be available in all providers. Since this is
usually used in development environment, we suggest you use this
feature during development and not worry about the portability aspect. <br>
<br>
<a name="26"></a><i><font color="#ff0000">Q. How do I generate the
tables with some specific columns being indexed?</font></i> <br>
<br>
If your column has a unique constraint associated with it, then you can
use: <br>
<br>
<b>@Column(unique=true)</b> <br>
<br>
Otherwise, you can use <b>columnDefinition </b>in <b>@Column</b> to
specify your own DDL. <br>
<br>
<a name="27"></a><i><font color="#ff0000">Q. Does Java2DB generate
constraints in the database?</font></i> <br>
<br>
Yes, it generates the appropriate primary keys, foreign keys etc.
<h4>Dependency Injection, JNDI lookup, EntityManager related questions </h4>
<a name="28"></a> <i><font color="#ff0000">Q. I am getting a
NullPointerException in my web application while trying to use the
injected EntityManager. What is the problem?</font></i> <br>
<br>
<span style="text-decoration: none;">This typically happens when you
have a web.xml in your war file and its version &lt; 2.5, i.e. it uses
a schema or dtd from an earlier version of the spec. I</span>njection
only works for a Java EE 5 application, so your web application needs
to be servlet 2.5 compliant. <span style="text-decoration: none;">Refer
to <a
 href="http://forums.java.net/jive/thread.jspa?forumID=56&amp;threadID=14141">http://forums.java.net/jive/thread.jspa?forumID=56&amp;threadID=14141</a>
for more details. </span><br>
<br>
<a name="29"></a><i><font color="#ff0000">Q. How should I get hold of
an EntityManager in my Servlet?</font></i> <br>
<br>
<span style="text-decoration: none;">Don't use @PersistenceContext to
inject an EntityManager into a Servlet. This is discussed in greater
detail at <a
 href="http://forums.java.net/jive/thread.jspa?forumID=56&amp;threadID=16808">http://forums.java.net/jive/thread.jspa?forumID=56&amp;threadID=16808</a></span>
<br>
That article describes ways to use both an application managed as well
as a container managed EntityManager. We recommend you use a container
managed EntityManager. <br>
<br>
<a name="30"></a><i><font color="#ff0000">Q. Can I use
javax.persistence.Persistence.createEntityManagerFactory() to get hold
of an EntityManagerFactory in my web application?</font></i> <br>
<br>
Yes, but this is not recommended because
javax.persistence.Persistence.createEntityManagerFactory() is designed
for use in a Java SE environment. In a Java EE environment, you can use
dependency injection or JNDI lookup to access an EntityManagerFactory
or an EntityManager as discussed earlier in this FAQ. Having said that,
if you are using a web container like Tomcat 5.x which does not support
Java Persistence API, then you have no option but to use this API. In
such a case, we recommend you choose a container like GlassFish which
supports the latest spec. <br>
<br>
<a name="31"></a><i><font color="#ff0000">Q. Can I use a resource-local
EntityManager in my web application?</font></i> <br>
<br>
Yes, you can use both resource-local as well as JTA EntityManager in
your web application. The same applies to an EJB application as well.
But, we recommend you use a JTA EntityManager in your web and EJB
applications and use a resource-local EntityManager in your Java SE or
Java EE client application. <br>
<br>
<a name="32"></a><i><font color="#ff0000">Q. I am calling merge, yet
the entity state is detached. What am I doing wrong?</font></i> <br>
<br>
<b>&lt;T&gt; T merge(T entity)</b> returns a new copy if the argument
is a detached entity. So, you need to use the returned object after
calling merge. This is a spec defined behavior. Refer to 3.2.4.1 of
spec which says the following: <br>
<br>
<i>If X is a detached entity, the state of X is copied onto a
pre-existing managed entity instance X' of the same identity or a new
managed copy X' of X is created.</i> <br>
<br>
Refer to <a
 href="http://forums.java.net/jive/thread.jspa?threadID=15178">http://forums.java.net/jive/thread.jspa?threadID=15178</a>
where a similar issue is discussed. <br>
<br>
<a name="33"></a><i><font color="#ff0000">Q. I have called em.merge(e)
and yet I am getting an IllegalArgumentException while trying to delete
an entity from the database using em.remove(e). What am I doing wrong?</font></i>
<br>
<br>
You have most probably ignored the return value of em.merge(). Refer to
<a
 href="http://forums.java.net/jive/thread.jspa?forumID=56&amp;threadID=16891">http://forums.java.net/jive/thread.jspa?forumID=56&amp;threadID=16891</a>
for more details. <br>
<br>
<a name="34"></a><i><font color="#ff0000">Q. EntityManager.persist()
throws TransactionRequiredException in a servlet. What am I doing wrong?</font></i>
<br>
<br>
<span style="text-decoration: none;">Refer to <a
 href="http://weblogs.java.net/blog/ss141213/archive/2005/12/entitymanagerpe_1.html">http://weblogs.java.net/blog/ss141213/archive/2005/12/entitymanagerpe_1.html</a></span>
<p class="western"> </p>
<h4>Miscellaneous Questions </h4>
<a name="35"></a> <i><font color="#ff0000">Q. I am getting a
“java.security.PrivilegedActionException : Error opening socket to
server localhost on port 1527 message : nullError Code: 0”.</font></i><span
 style="font-style: italic; color: rgb(255, 0, 0);"> What am I doing
wrong?</span><br>
<br>
The potential cause of this exception is that your Derby (a.k.a.
JavaDB) database is not running. You can use “<b>asadmin start-database"</b>
to start the database. <br>
<br>
<a name="41"></a><i><font color="#ff0000">Q. What is the purpose of
-javaagent option? What happens if I don't use it?</font></i> <br>
<em></em><br>
<em>-javaagent:toplink-essentials-agent.jar</em> is only useful when
you have one-to-one or many-to-one lazily fetched relationships. If you
omit it, your program will still work, but one-to-one and many-to-one
relationships will be fetched eagerly. For more detail, please refer to
<a
 href="http://weblogs.java.net/blog/cayhorstmann/archive/2006/06/the_innermost_s.html">http://weblogs.java.net/blog/cayhorstmann/archive/2006/06/the_innermost_s.html</a>
<br>
<br>
<a name="42"></a><i><font color="#ff0000">Q. <span
 style="text-decoration: none;">How can I configure the cache used by
TopLink Essentials?</span></font></i> <br>
<br>
<font color="#000000">There are various properties that you can use in
your persistence.xml file to configure different aspects of cache used
by TopLink Essentials. Please read <a
 href="http://www.oracle.com/technology/products/ias/toplink/jpa/resources/toplink-jpa-extensions.html#TopLinkCaching">http://www.oracle.com/technology/products/ias/toplink/jpa/resources/toplink-jpa-extensions.html#TopLinkCaching</a>
for more details.</font> <br>
<span style="font-family: &quot;courier&quot;,monospace;"><span
 style="font-style: italic;"><br>
</span></span><a name="44"></a><i><font color="#ff0000">Q. <span
 style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-inline-policy: initial; -moz-background-origin: initial;">How
do I configure the logging level for Toplink?</span></font></i><br>
<br>
<span
 style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-inline-policy: initial; -moz-background-origin: initial;">For
both Java SE and EE, You can set the logging level for a persistence
unit by using the following property:</span>
<p class="western" style="font-style: normal;"><font
 face="Courier, monospace"><span
 style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-inline-policy: initial; -moz-background-origin: initial;">&lt;property
name="toplink.logging.level" value="%DESIRED_LOGGING_LEVEL"/&gt;</span></font></p>
<span
 style="background: transparent none repeat scroll 0%; -moz-background-clip: initial; -moz-background-inline-policy: initial; -moz-background-origin: initial;">In
GlassFish, you can set the global log level for all the persistence
units using the admin GUI or <span style="font-style: italic;">asadmin</span>
CLI. The value specified in persistence.xml overrides the global log
level. Please read </span><br>
<a class="moz-txt-link-freetext"
 href="https://glassfish.dev.java.net/javaee5/persistence/entity-persistence-support.html#Logging">https://glassfish.dev.java.net/javaee5/persistence/entity-persistence-support.html#Logging</a>
for more details.<br>
<br>
<a name="45"></a><font color="#ff0000"><i>Q. How can I see the sql
generated by Toplink Essentials?</i></font><br>
<br>
Set the logging level to <b>FINE</b> to see the sql generated by
Toplink Essentials.<br>
<br>
<a name="43"></a><i><font color="#ff0000">Q. How can I control the
connection pool settings for an entity manager in a Java SE environment?</font></i>
<br>
<br>
<span style="text-decoration: none;"><font color="#000000">You can use
the following properties in your persistence.xml to control the number
of connections used by TopLink Essentials:</font></span><br>
<p class="western"><code><code><span style="text-decoration: none;"><i><font
 color="#000000">toplink.jdbc.read-connections.max<span
 style="text-decoration: none;"><font color="#000000"> </font></span><br>
toplink.jdbc.read-connections.min <br>
toplink.jdbc.read-connections.shared<br>
toplink.jdbc.write-connections.max<br>
toplink.jdbc.write-connections.min<br>
</font></i></span></code></code></p>
<span style="text-decoration: none;"><font color="#000000">as described
in&nbsp; </font><a
 href="http://www.oracle.com/technology/products/ias/toplink/jpa/resources/toplink-jpa-extensions.html#TopLinkJDBC"
 style="color: rgb(0, 0, 238);">http://www.oracle.com/technology/products/ias/toplink/jpa/resources/toplink-jpa-extensions.html#TopLinkJDBC</a></span>
<p class="western"><br>
<br>
</p>
<p class="western"><br>
<br>
</p>
</div>
</body>
</html>
